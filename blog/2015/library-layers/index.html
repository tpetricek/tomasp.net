<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <meta name=viewport content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Droid+Sans+Mono&family=Kreon:wght@300;400;500;600&family=PT+Sans:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="alternate" type="application/rss+xml" title="Latest news from Tomas Petricek" href="/rss.xml" />
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  <link href="/custom/style.css" rel="stylesheet">
  <link href="/custom/tooltips.css" rel="stylesheet">
  <script src="/custom/tooltips.js" type="text/javascript"></script>
  <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon-big.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/img/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/img/favicon-big.png">
  <meta name="msapplication-TileColor" content="#004C6B">
  <meta name="msapplication-TileImage" content="/img/favicon-big.png">
  <meta name="theme-color" content="#004C6B">
  
  <title>Library patterns: Multiple levels of abstraction - Tomas Petricek</title>

  <meta name="description" content=" Over the last few years, I created or contributed to a number of libraries. In this blog post (or perhaps a series), I'll share some of the things I learned when trying to answer the question: What should a good library look like? I'll start by looking at a library design pattern that I call 'levels of abstraction'." />
  <meta name="keywords" content="f#, open source, functional programming, " />  
  <meta name="author" content="Tomas Petricek" />
  <meta name="copyright" content="Tomas Petricek" />
  
  <meta property="og:title" content="Library patterns: Multiple levels of abstraction" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="http://tomasp.net/blog/2015/library-layers/" />
  <meta property="og:image" content="http://tomasp.net/blog/2015/library-layers/layers.png" />
  <meta property="og:description" content=" Over the last few years, I created or contributed to a number of libraries. In this blog post (or perhaps a series), I'll share some of the things I learned when trying to answer the question: What should a good library look like? I'll start by looking at a library design pattern that I call 'levels of abstraction'." />
  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@tomaspetricek">
  <meta name="twitter:creator" content="@tomaspetricek">  
  <meta name="twitter:title" content="Library patterns: Multiple levels of abstraction" />
  <meta name="twitter:image" content="http://tomasp.net/blog/2015/library-layers/layers.png" />
  <meta name="twitter:description" content=" Over the last few years, I created or contributed to a number of libraries. In this blog post (or perhaps a series), I'll share some of the things I learned when trying to answer the question: What should a good library look like? I'll start by looking at a library design pattern that I call 'levels of abstraction'." />
    
  <script type="application/ld+json">
  {
  	"@context": "http:\/\/schema.org",
  	"@type": "Article",
  	"name": "Library patterns: Multiple levels of abstraction",
    "headline": "Library patterns: Multiple levels of abstraction",
  	"description": " Over the last few years, I created or contributed to a number of libraries. In this blog post (or perhaps a series), I'll share some of the things I learned when trying to answer the question: What should a good library look like? I'll start by looking at a library design pattern that I call 'levels of abstraction'.",
  	"url": "http://tomasp.net/blog/2015/library-layers/",
  	"author": {
  		"@type": "Person",
  		"name": "Tomas Petricek",
  		"url": "http://tomasp.net",
  		"sameAs": ["http://twitter.com/tomaspetricek"]
  	},
  	"creator": ["Tomas Petricek"],
  	"dateCreated": "2015-02-03T16:54:30.6183730+01:00",
  	"datePublished": "2015-02-03T16:54:30.6183730+01:00",
    "dateModified": "2015-02-03T16:54:30.6183730+01:00",
    "mainEntityOfPage": "http://tomasp.net/blog/2015/library-layers/",
  	"image": "http://tomasp.net/blog/2015/library-layers/layers.png",
  	"thumbnailUrl": "http://tomasp.net/blog/2015/library-layers/layers.png",
  	"keywords": ["f#", "open source", "functional programming",  "tomas", "petricek"],
  	"inLanguage": "en-us",
  	"publisher": {
  		"@type": "Person",
  		"name": "Tomas Petricek",
  		"url": "http://tomasp.net",
      "logo": "http://tomasp.net/img/favicon-big.png",
  		"sameAs": ["http://twitter.com/tomaspetricek"]
  	}
  }  
  </script>

</head>
<body class="default">
    
  <span class="tplink"><a href="/">TP</a></span>

  <article class='article''>
    <h1><span class="hm">Library patterns</span><span class="hs"> Multiple levels of abstraction</span></h1>
<p>Over the last few years, I created or contributed to a number of libraries including
<a href="https://github.com/fsharp/FSharp.Data">F# Data</a> for data access,
<a href="http://bluemountaincapital.github.io/Deedle/">Deedle</a> for exploratory data science with C# and F#,
Markdown parser and code-formatter <a href="http://tpetricek.github.io/FSharp.Formatting/">F# Formatting</a>
and other fun libraries such as one for composing 3D objects <a href="http://tomasp.net/blog/2014/composing-christmas/">used in my Christmas blog
post</a>.</p>
<p>Building libraries is a fun and challenging task - even if we ignore all the additional things
that you need to get right such as testing, documentation and building (see <a href="http://tomasp.net/blog/2013/great-open-source/">my earlier blog
post</a>) and focus just on the API design.
In this blog post (or perhaps a series), I'll share some of the things I learned when trying
to answer the question: What should a good library look like?</p>
<h3>Library design patterns</h3>
<p>I was recently watching Mark Seemann's course <a href="http://blog.ploeh.dk/2014/01/22/a-functional-architecture-with-f/">A Functional architecture with F#</a>,
which is a great material on designing functional <em>applications</em>. But I also realised that not much
has been written on designing functional <em>libraries</em>. For some aspect, you can use functional patterns
like monads (see <a href="https://skillsmatter.com/skillscasts/6120-functional-programming-design-patterns-with-scott-wlaschin">Scott Wlaschin's presentation</a>),
but this only answers a part of the question - it tells you how to design individual types, but
not an entire library.</p>
<p>The key library design principles that I find useful (and follow in libraries that I work on) are:</p>
<ul>
<li>
<p><strong>Iterative design.</strong> First of all, you should never start designing a library by <em>designing
a library</em>. In F#, you can put a lot of functionality in just a script file and reference it
(or copy it to other projects). This is the best way to explore what you'll actually need from
a library. Once you have a better idea, you can turn the (single) file into a new project.</p>
</li>
<li>
<p><strong>Composable.</strong> Composability is the key principle of functional programming <em>in general</em> and
it is equally important for library design. A library should always expose functionality in a
way that lets the user build more complex behaviour from simpler building blocks (in contrast
to offering simple complex entry point that can be, to some extent, parameterized).</p>
</li>
<li>
<p><strong>Avoid callbacks.</strong> Callbacks are probably the easiest way of breaking composability. When
you are writing some complex functionality (say, processing Markdown documentation), you might
be tempted to parameterize some step using a callback (say, to plug-in a pre-processor that
transforms document between parsing and rendering).
The problem is that callbacks impose too much structure on your code. They do not give you
the flexibility to put individual <em>simpler pieces</em> together in a different way. Instead,
inserting callbacks makes the design <em>more complicated</em> than it was.</p>
</li>
<li>
<p><strong>Levels of abstraction.</strong> So, how can we expose simple API that is simple to use and
can be used in multiple different ways? The key idea is to provide multiple levels of
abstraction. This is what I want to discuss in this article, so continue reading!</p>
</li>
</ul>
<p>The concepts in the above list are related, but I think they are all key to good library design.
They would each deserve a separate article (which may happen if there is enough interest :-)), but
I'm going to focus on levels of abstractions first...</p>
<h2>How are libraries used?</h2>
<img src="layers.png" style="float:right;margin:15px 0px 15px 10px" />
<p>Each library is designed with some typical scenarios in mind. For example, F# Formatting lets
you <a href="http://tpetricek.github.io/FSharp.Formatting/literate.html#Processing-entire-directories">generate documentation from all files in a directory</a>.
This is all you need in, perhaps, 80% of scenarios. Sometimes, you need to handle individual
files differently (say, use a different template). A good library needs to <a href="http://tpetricek.github.io/FSharp.Formatting/literate.html#Processing-individual-files">make this possible
too</a>.
But sometimes, you actually want to process a file differently - for example, add an automatically
generated TOC (table of contents).</p>
<p>An approach that I find extremely useful is to build a library that exposes the functionality
as multiple layers of abstraction. At the highest level, you can handle the 80% of scenarios with
just a single function call. If you need, you can go one level deeper and implement the next 15%
of more interesting scenarios. And if you really need, you can go even deeper and implement the
next 4% of scenarios (and for the last 1%, you have to send a pull request!)</p>
<p>As you'll see, this <em>design pattern</em> is heavily used in core functional libraries such as the F#
library for working with lists. Following this pattern well also turns your libraries into
<em>domain specific languages</em> and makes the code more readable.</p>
<h2>Demo #1: Working with functional lists</h2>
<p>The idea of having multiple levels of abstraction can be easily demonstrated using lists.</p>
<h3>High-level: Higher-order functions</h3>
<p>At the high level, you can process lists using higher-order functions (or using LINQ in C#).
As a (somewhat) silly example, if we want to get a list of positive <code>sin</code> values of integers
from 0 to 100, we can write:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[<span class="n">0</span> <span class="o">..</span> <span class="n">100</span>]
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs43', 96)" onmouseover="showTip(event, 'fs43', 96)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs44', 97)" onmouseover="showTip(event, 'fs44', 97)" class="f">map</span> (<span onmouseout="hideTip(event, 'fs45', 98)" onmouseover="showTip(event, 'fs45', 98)" class="f">float</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs46', 99)" onmouseover="showTip(event, 'fs46', 99)" class="f">sin</span>)
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs43', 100)" onmouseover="showTip(event, 'fs43', 100)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs47', 101)" onmouseover="showTip(event, 'fs47', 101)" class="f">filter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs48', 102)" onmouseover="showTip(event, 'fs48', 102)" class="i">n</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs48', 103)" onmouseover="showTip(event, 'fs48', 103)" class="i">n</span> <span class="o">&gt;</span> <span class="n">0.0</span>)
</code></pre></td>
</tr>
</table>
<p>Higher-order functions like <code>List.map</code> and <code>List.filter</code> cover the 80% of scenarios when
working with lists (or perhaps even more). But sometimes you may want to do something that
is not covered by the higher-order functions.</p>
<h3>Low-level: Recursion and patter matching</h3>
<p>For example, say we want to split a list into two, around the point where the sign of
the values in the list changes. That is <code>splitAtSignChange [1; 4; -3; 2]</code> should return
<code>[1; 4]</code> and <code>[-3; 2]</code>. This is not easy to do using higher-order functions, but we can
use the lower-level API and write a recursive function that pattern matches on the list:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Split a list at the point where the </span>
<span class="c">/// sign of adjacent elements changes</span>
<span class="k">let</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs49', 104)" onmouseover="showTip(event, 'fs49', 104)" class="f">splitAtSignChange</span> <span onmouseout="hideTip(event, 'fs50', 105)" onmouseover="showTip(event, 'fs50', 105)" class="i">list</span> <span class="o">=</span>
  <span class="c">// Keeps the last element and elements visited so</span>
  <span class="c">// far (before the sign change) in a reversed list</span>
  <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs51', 106)" onmouseover="showTip(event, 'fs51', 106)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs52', 107)" onmouseover="showTip(event, 'fs52', 107)" class="i">last</span> <span onmouseout="hideTip(event, 'fs53', 108)" onmouseover="showTip(event, 'fs53', 108)" class="i">acc</span> <span class="o">=</span> <span class="k">function</span>
    | [] <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs43', 109)" onmouseover="showTip(event, 'fs43', 109)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 110)" onmouseover="showTip(event, 'fs54', 110)" class="f">rev</span> <span onmouseout="hideTip(event, 'fs53', 111)" onmouseover="showTip(event, 'fs53', 111)" class="i">acc</span>, []
    | <span onmouseout="hideTip(event, 'fs55', 112)" onmouseover="showTip(event, 'fs55', 112)" class="i">first</span><span class="o">::</span><span onmouseout="hideTip(event, 'fs56', 113)" onmouseover="showTip(event, 'fs56', 113)" class="i">tail</span> <span class="k">as</span> <span onmouseout="hideTip(event, 'fs50', 114)" onmouseover="showTip(event, 'fs50', 114)" class="i">list</span> <span class="k">when</span> <span onmouseout="hideTip(event, 'fs57', 115)" onmouseover="showTip(event, 'fs57', 115)" class="f">sign</span> <span class="i">first</span> <span class="o">&lt;&gt;</span> <span onmouseout="hideTip(event, 'fs57', 116)" onmouseover="showTip(event, 'fs57', 116)" class="f">sign</span> <span onmouseout="hideTip(event, 'fs52', 117)" onmouseover="showTip(event, 'fs52', 117)" class="i">last</span> <span class="k">-&gt;</span> 
        <span onmouseout="hideTip(event, 'fs43', 118)" onmouseover="showTip(event, 'fs43', 118)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 119)" onmouseover="showTip(event, 'fs54', 119)" class="f">rev</span> <span onmouseout="hideTip(event, 'fs53', 120)" onmouseover="showTip(event, 'fs53', 120)" class="i">acc</span>, <span onmouseout="hideTip(event, 'fs50', 121)" onmouseover="showTip(event, 'fs50', 121)" class="i">list</span>
    | <span onmouseout="hideTip(event, 'fs55', 122)" onmouseover="showTip(event, 'fs55', 122)" class="i">first</span><span class="o">::</span><span onmouseout="hideTip(event, 'fs56', 123)" onmouseover="showTip(event, 'fs56', 123)" class="i">tail</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs51', 124)" onmouseover="showTip(event, 'fs51', 124)" class="f">loop</span> <span class="i">first</span> (<span class="i">first</span><span class="o">::</span><span onmouseout="hideTip(event, 'fs53', 125)" onmouseover="showTip(event, 'fs53', 125)" class="i">acc</span>) <span onmouseout="hideTip(event, 'fs56', 126)" onmouseover="showTip(event, 'fs56', 126)" class="i">tail</span>

  <span class="c">// Use the first element as &#39;last&#39; argument of &#39;loop&#39;</span>
  <span class="k">match</span> <span onmouseout="hideTip(event, 'fs50', 127)" onmouseover="showTip(event, 'fs50', 127)" class="i">list</span> <span class="k">with</span>
  | [] <span class="k">-&gt;</span> [], []
  | <span onmouseout="hideTip(event, 'fs58', 128)" onmouseover="showTip(event, 'fs58', 128)" class="i">head</span><span class="o">::</span><span onmouseout="hideTip(event, 'fs56', 129)" onmouseover="showTip(event, 'fs56', 129)" class="i">tail</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs51', 130)" onmouseover="showTip(event, 'fs51', 130)" class="f">loop</span> <span class="i">head</span> [<span class="i">head</span>] <span onmouseout="hideTip(event, 'fs56', 131)" onmouseover="showTip(event, 'fs56', 131)" class="i">tail</span>
</code></pre></td>
</tr>
</table>
<p>The function is more difficult to understand than the code we can write with higher-order
functions, but it is still quite readable. Inside <code>loop</code>, there are 3 cases that handle
the situations when 1.) all elements have the same sign 2.) we find a sign change and 3.)
we skip over element before a sign change.</p>
<p>If you were writing this in C# using <code>IEnumerable&lt;T&gt;</code>, you don't get nice pattern matching
on lists, but you still get <em>some</em> lower-level API (using <code>GetEnumerator</code>, temporary collections
and mutation).</p>
<h3>Going from low-level to high-level</h3>
<p>The beautiful thing about the collection API design is that we can now move back from the
lower level to the higher level. The function <code>splitAtSignChange</code> can be seen as an instance
of a more general operation where we split a list based on a predicate applied to two adjacent
elements.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">module</span> <span onmouseout="hideTip(event, 'fs43', 132)" onmouseover="showTip(event, 'fs43', 132)" class="t">List</span> <span class="o">=</span>
  <span class="c">/// Splits a list into two when the predicate &#39;f&#39;</span>
  <span class="c">/// returns &#39;true&#39; on two adjacent elements of the list</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs59', 133)" onmouseover="showTip(event, 'fs59', 133)" class="f">splitAt</span> <span onmouseout="hideTip(event, 'fs60', 134)" onmouseover="showTip(event, 'fs60', 134)" class="f">f</span> <span onmouseout="hideTip(event, 'fs61', 135)" onmouseover="showTip(event, 'fs61', 135)" class="i">list</span> <span class="o">=</span>
    <span class="c">// Same as before with &#39;f first last&#39; in the second case</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs62', 136)" onmouseover="showTip(event, 'fs62', 136)" class="f">loop</span> <span onmouseout="hideTip(event, 'fs63', 137)" onmouseover="showTip(event, 'fs63', 137)" class="i">last</span> <span onmouseout="hideTip(event, 'fs64', 138)" onmouseover="showTip(event, 'fs64', 138)" class="i">acc</span> <span class="o">=</span> <span class="k">function</span>
      | [] <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs43', 139)" onmouseover="showTip(event, 'fs43', 139)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 140)" onmouseover="showTip(event, 'fs54', 140)" class="f">rev</span> <span onmouseout="hideTip(event, 'fs64', 141)" onmouseover="showTip(event, 'fs64', 141)" class="i">acc</span>, []
      | <span onmouseout="hideTip(event, 'fs65', 142)" onmouseover="showTip(event, 'fs65', 142)" class="i">first</span><span class="o">::</span><span onmouseout="hideTip(event, 'fs66', 143)" onmouseover="showTip(event, 'fs66', 143)" class="i">tail</span> <span class="k">as</span> <span onmouseout="hideTip(event, 'fs61', 144)" onmouseover="showTip(event, 'fs61', 144)" class="i">list</span> <span class="k">when</span> <span onmouseout="hideTip(event, 'fs60', 145)" onmouseover="showTip(event, 'fs60', 145)" class="f">f</span> <span onmouseout="hideTip(event, 'fs63', 146)" onmouseover="showTip(event, 'fs63', 146)" class="i">last</span> <span class="i">first</span> <span class="k">-&gt;</span> 
          <span onmouseout="hideTip(event, 'fs43', 147)" onmouseover="showTip(event, 'fs43', 147)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 148)" onmouseover="showTip(event, 'fs54', 148)" class="f">rev</span> <span onmouseout="hideTip(event, 'fs64', 149)" onmouseover="showTip(event, 'fs64', 149)" class="i">acc</span>, <span onmouseout="hideTip(event, 'fs61', 150)" onmouseover="showTip(event, 'fs61', 150)" class="i">list</span>
      | <span onmouseout="hideTip(event, 'fs65', 151)" onmouseover="showTip(event, 'fs65', 151)" class="i">first</span><span class="o">::</span><span onmouseout="hideTip(event, 'fs66', 152)" onmouseover="showTip(event, 'fs66', 152)" class="i">tail</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs62', 153)" onmouseover="showTip(event, 'fs62', 153)" class="f">loop</span> <span class="i">first</span> (<span class="i">first</span><span class="o">::</span><span onmouseout="hideTip(event, 'fs64', 154)" onmouseover="showTip(event, 'fs64', 154)" class="i">acc</span>) <span onmouseout="hideTip(event, 'fs66', 155)" onmouseover="showTip(event, 'fs66', 155)" class="i">tail</span>

    <span class="c">// Use the first element as &#39;last&#39; argument of &#39;loop&#39;</span>
    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs61', 156)" onmouseover="showTip(event, 'fs61', 156)" class="i">list</span> <span class="k">with</span>
    | [] <span class="k">-&gt;</span> [], []
    | <span onmouseout="hideTip(event, 'fs67', 157)" onmouseover="showTip(event, 'fs67', 157)" class="i">head</span><span class="o">::</span><span onmouseout="hideTip(event, 'fs66', 158)" onmouseover="showTip(event, 'fs66', 158)" class="i">tail</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs62', 159)" onmouseover="showTip(event, 'fs62', 159)" class="f">loop</span> <span class="i">head</span> [<span class="i">head</span>] <span onmouseout="hideTip(event, 'fs66', 160)" onmouseover="showTip(event, 'fs66', 160)" class="i">tail</span>
</code></pre></td>
</tr>
</table>
<p>The function is pretty much the same as before - it takes an additional parameter <code>f</code> and uses
it to decide when to break the list. Although the function is itself implemented using the
lower-level API, it gives us a way to get back to the higher-level!</p>
<img src="loop.png" />
<p>Getting back to the higher level means that we can recover the much simpler programming
style. Say, we wanted to take <code>sin</code> values of integers from 1 to 10 and split them into
two lists, based on when the value crosses the X axis:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp">[<span class="n">1</span> <span class="o">..</span> <span class="n">10</span>]
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs68', 161)" onmouseover="showTip(event, 'fs68', 161)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs44', 162)" onmouseover="showTip(event, 'fs44', 162)" class="f">map</span> (<span onmouseout="hideTip(event, 'fs45', 163)" onmouseover="showTip(event, 'fs45', 163)" class="f">float</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs46', 164)" onmouseover="showTip(event, 'fs46', 164)" class="f">sin</span>)
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs68', 165)" onmouseover="showTip(event, 'fs68', 165)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs69', 166)" onmouseover="showTip(event, 'fs69', 166)" class="f">splitAt</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs70', 167)" onmouseover="showTip(event, 'fs70', 167)" class="i">a</span> <span onmouseout="hideTip(event, 'fs71', 168)" onmouseover="showTip(event, 'fs71', 168)" class="i">b</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs57', 169)" onmouseover="showTip(event, 'fs57', 169)" class="f">sign</span> <span onmouseout="hideTip(event, 'fs70', 170)" onmouseover="showTip(event, 'fs70', 170)" class="i">a</span> <span class="o">&lt;&gt;</span> <span onmouseout="hideTip(event, 'fs57', 171)" onmouseover="showTip(event, 'fs57', 171)" class="f">sign</span> <span onmouseout="hideTip(event, 'fs71', 172)" onmouseover="showTip(event, 'fs71', 172)" class="i">b</span>)
</code></pre></td>
</tr>
</table>
<p>Now we are back at the high-level and we can solve the problem using two simple and easy
to understand lines of code.</p>
<p>Functional lists with their low-level pattern matching and high-level functions are
a nice example of a library with multiple levels of abstractions. But how does this
work in other scenarios?</p>
<blockquote>
<p><strong>Non-Example: Reactive Extensions</strong></p>
<p>One of the things I always found quite unfortunate about the Rx library is that it
fails this principle. It provides a nice high-level abstraction (through the standard
LINQ operators), but it does not give you any convenient way to implement your own
operators using a lower level API. You can see this when you look at the
standard <code>Select</code> operator, which <a href="https://rx.codeplex.com/SourceControl/latest#Rx.NET/Source/System.Reactive.Linq/Reactive/Linq/Observable/Select.cs">is 125 lines of code</a>
(compare this with <code>List.map</code> in the F# library, which is <a href="https://github.com/fsharp/fsharp/blob/master/src/fsharp/FSharp.Core/local.fs#L43">16 lines</a>
and could be 3 if it was not optimized using mutation).</p>
<p>Of course, Rx is solving significantly more complicated task than the <code>List</code> module, but
that is not the point - the point is that <code>Select</code> should be easy to implement using <em>some</em> lower-level
abstraction. What should this look like? In F#, this would probably be done using
<a href="http://www.developerfusion.com/article/139804/an-introduction-to-f-agents/">agents</a> or
library such as <a href="http://hopac.github.io/Hopac/Hopac.html">Hopac</a>.</p>
</blockquote>
<h2>Demo #2: Domain-specific languages for 3D</h2>
<p>In a <a href="http://tomasp.net/blog/2014/composing-christmas/">blog post</a> that I wrote for the
<a href="https://sergeytihon.wordpress.com/2014/11/24/f-advent-calendar-in-english-2014/">F# Advent Calendar</a>,
I used a library for composing 3D objects. This is another good example of a library that
provides multiple levels of abstraction - especially when you use it to model custom objects.</p>
<h3>Very-high-level: Building castles</h3>
<p>For example, have a look at what you can achieve with the following snippet:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs7', 173)" onmouseover="showTip(event, 'fs7', 173)" class="f">tower</span> <span class="o">-</span><span class="n">2.0</span> <span class="o">-</span><span class="n">2.0</span> <span class="o">$</span> <span onmouseout="hideTip(event, 'fs7', 174)" onmouseover="showTip(event, 'fs7', 174)" class="f">tower</span> <span class="n">2.0</span> <span class="o">-</span><span class="n">2.0</span> <span class="o">$</span> 
<span onmouseout="hideTip(event, 'fs7', 175)" onmouseover="showTip(event, 'fs7', 175)" class="f">tower</span> <span class="o">-</span><span class="n">2.0</span> <span class="n">2.0</span> <span class="o">$</span> <span onmouseout="hideTip(event, 'fs7', 176)" onmouseover="showTip(event, 'fs7', 176)" class="f">tower</span> <span class="n">2.0</span> <span class="n">2.0</span> <span class="o">$</span>
<span onmouseout="hideTip(event, 'fs29', 177)" onmouseover="showTip(event, 'fs29', 177)" class="f">wall</span> <span class="o">-</span><span class="n">2.0</span> <span class="k">true</span> <span class="o">$</span> <span onmouseout="hideTip(event, 'fs29', 178)" onmouseover="showTip(event, 'fs29', 178)" class="f">wall</span> <span class="n">2.0</span> <span class="k">true</span> <span class="o">$</span>
<span onmouseout="hideTip(event, 'fs29', 179)" onmouseover="showTip(event, 'fs29', 179)" class="f">wall</span> <span class="o">-</span><span class="n">2.0</span> <span class="k">false</span> <span class="o">$</span> <span onmouseout="hideTip(event, 'fs29', 180)" onmouseover="showTip(event, 'fs29', 180)" class="f">wall</span> <span class="n">2.0</span> <span class="k">false</span>
</code></pre></td>
</tr>
</table>
<p style="text-align:center"><img src="castle.png" style="width:407px" /></p>
<p>At the highest level of abstraction, we can create a castle with just 4 lines of code!
Of course, this level of abstraction lets you create only very limited things (castles
with walls and towers), but if you are a castle-builder, this might be what you need...</p>
<blockquote>
<p><strong>Domain-specific languages</strong></p>
<p>The term "domain-specific languages" (DSLs) means different things to different people.
For me, a library like this is an (embedded) DSL, because it lets you express your
intentions in a very readable way using just a vocabulary of the specific domain.
In a sense, the higher levels of abstraction of any composable functional library
should always be domain-specific languages.</p>
</blockquote>
<h3>High-level: Composing 3D objects</h3>
<p>Now, what if we wanted to build a castle with different towers? To do that, we still don't
need to look at any low-level 3D rendering code. The <code>tower</code> function itself is written
in terms of another "language" or "level of abstraction". A tower is just a coloured
cylinder, composed with a coloured cone that are appropriately rotated:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs7', 181)" onmouseover="showTip(event, 'fs7', 181)" class="f">tower</span> <span onmouseout="hideTip(event, 'fs8', 182)" onmouseover="showTip(event, 'fs8', 182)" class="i">x</span> <span onmouseout="hideTip(event, 'fs9', 183)" onmouseover="showTip(event, 'fs9', 183)" class="i">z</span> <span class="o">=</span> 
  (<span onmouseout="hideTip(event, 'fs10', 184)" onmouseover="showTip(event, 'fs10', 184)" class="t">Fun</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 185)" onmouseover="showTip(event, 'fs11', 185)" class="i">cylinder</span>
     <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 186)" onmouseover="showTip(event, 'fs10', 186)" class="t">Fun</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 187)" onmouseover="showTip(event, 'fs12', 187)" class="f">scale</span> (<span class="n">1.0</span>, <span class="n">1.0</span>, <span class="n">3.0</span>) 
     <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 188)" onmouseover="showTip(event, 'fs10', 188)" class="t">Fun</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 189)" onmouseover="showTip(event, 'fs13', 189)" class="f">translate</span> (<span class="n">0.0</span>, <span class="n">0.0</span>, <span class="n">1.0</span>)
     <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 190)" onmouseover="showTip(event, 'fs10', 190)" class="t">Fun</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 191)" onmouseover="showTip(event, 'fs14', 191)" class="f">color</span> <span onmouseout="hideTip(event, 'fs15', 192)" onmouseover="showTip(event, 'fs15', 192)" class="t">Color</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 193)" onmouseover="showTip(event, 'fs16', 193)" class="i">DarkGoldenrod</span> ) <span class="o">$</span> 
  (<span onmouseout="hideTip(event, 'fs10', 194)" onmouseover="showTip(event, 'fs10', 194)" class="t">Fun</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs17', 195)" onmouseover="showTip(event, 'fs17', 195)" class="i">cone</span> 
     <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 196)" onmouseover="showTip(event, 'fs10', 196)" class="t">Fun</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 197)" onmouseover="showTip(event, 'fs12', 197)" class="f">scale</span> (<span class="n">1.3</span>, <span class="n">1.3</span>, <span class="n">1.3</span>) 
     <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 198)" onmouseover="showTip(event, 'fs10', 198)" class="t">Fun</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 199)" onmouseover="showTip(event, 'fs13', 199)" class="f">translate</span> (<span class="n">0.0</span>, <span class="n">0.0</span>, <span class="o">-</span><span class="n">1.0</span>)
     <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 200)" onmouseover="showTip(event, 'fs10', 200)" class="t">Fun</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 201)" onmouseover="showTip(event, 'fs14', 201)" class="f">color</span> <span onmouseout="hideTip(event, 'fs15', 202)" onmouseover="showTip(event, 'fs15', 202)" class="t">Color</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs18', 203)" onmouseover="showTip(event, 'fs18', 203)" class="i">Red</span> )
  <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 204)" onmouseover="showTip(event, 'fs10', 204)" class="t">Fun</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 205)" onmouseover="showTip(event, 'fs19', 205)" class="f">rotate</span> (<span class="n">90.0</span>, <span class="n">0.0</span>, <span class="n">0.0</span>)
  <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 206)" onmouseover="showTip(event, 'fs10', 206)" class="t">Fun</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 207)" onmouseover="showTip(event, 'fs13', 207)" class="f">translate</span> (<span onmouseout="hideTip(event, 'fs8', 208)" onmouseover="showTip(event, 'fs8', 208)" class="i">x</span>, <span class="n">0.5</span>, <span onmouseout="hideTip(event, 'fs9', 209)" onmouseover="showTip(event, 'fs9', 209)" class="i">z</span>)
</code></pre></td>
</tr>
</table>
<p>When using the library, you might start at the very high level of abstraction (solving
specific narrow problems), but as you become more familiar with it, you can move one
level down. At this level, you can build your own languages (abstractions) in the same
way as when we implemented <code>List.splitAt</code> in terms of recursion and pattern matching.</p>
<h3>Low-level: Rendering faces with OpenGL</h3>
<p>Now, there is still a lower level at which the actual 3D rendering happens. In this
library, the lower level is simply calling OpenGL primitives (using the OpenTK wrapper),
and so this is not particularly interesting, but it is not very complicated either:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs72', 210)" onmouseover="showTip(event, 'fs72', 210)" class="i">cube</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs73', 211)" onmouseover="showTip(event, 'fs73', 211)" class="p">DF</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs74', 212)" onmouseover="showTip(event, 'fs74', 212)" class="i">ctx</span> <span class="k">-&gt;</span>
  <span onmouseout="hideTip(event, 'fs75', 213)" onmouseover="showTip(event, 'fs75', 213)" class="t">GL</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs76', 214)" onmouseover="showTip(event, 'fs76', 214)" class="f">Material</span>
    ( <span onmouseout="hideTip(event, 'fs77', 215)" onmouseover="showTip(event, 'fs77', 215)" class="t">MaterialFace</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs78', 216)" onmouseover="showTip(event, 'fs78', 216)" class="i">FrontAndBack</span>, 
      <span onmouseout="hideTip(event, 'fs79', 217)" onmouseover="showTip(event, 'fs79', 217)" class="t">MaterialParameter</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs80', 218)" onmouseover="showTip(event, 'fs80', 218)" class="i">Diffuse</span>, <span onmouseout="hideTip(event, 'fs74', 219)" onmouseover="showTip(event, 'fs74', 219)" class="i">ctx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs81', 220)" onmouseover="showTip(event, 'fs81', 220)" class="i">Color</span>)
  <span onmouseout="hideTip(event, 'fs75', 221)" onmouseover="showTip(event, 'fs75', 221)" class="t">GL</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs82', 222)" onmouseover="showTip(event, 'fs82', 222)" class="f">Begin</span>(<span onmouseout="hideTip(event, 'fs83', 223)" onmouseover="showTip(event, 'fs83', 223)" class="t">BeginMode</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs84', 224)" onmouseover="showTip(event, 'fs84', 224)" class="i">Quads</span>)
  <span onmouseout="hideTip(event, 'fs85', 225)" onmouseover="showTip(event, 'fs85', 225)" class="t">GLEx</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs86', 226)" onmouseover="showTip(event, 'fs86', 226)" class="f">Face</span> 
    (<span class="o">-</span><span class="n">1.f</span>, <span class="n">0.f</span>, <span class="n">0.f</span>) 
    [ (<span class="o">-</span><span class="n">0.5f</span>, <span class="o">-</span><span class="n">0.5f</span>, <span class="o">-</span><span class="n">0.5f</span>); (<span class="o">-</span><span class="n">0.5f</span>, <span class="o">-</span><span class="n">0.5f</span>,  <span class="n">0.5f</span>); 
      (<span class="o">-</span><span class="n">0.5f</span>,  <span class="n">0.5f</span>,  <span class="n">0.5f</span>);  (<span class="o">-</span><span class="n">0.5f</span>,  <span class="n">0.5f</span>, <span class="o">-</span><span class="n">0.5f</span>) ] 
  <span id="fst87" onmouseout="hideTip(event, 'fs87', 227)" onmouseover="showTip(event, 'fs87', 227, document.getElementById('fst87'))" class="omitted">(Remaining 5 faces omitted)</span>
  <span onmouseout="hideTip(event, 'fs75', 228)" onmouseover="showTip(event, 'fs75', 228)" class="t">GL</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs88', 229)" onmouseover="showTip(event, 'fs88', 229)" class="f">End</span>() )
</code></pre></td>
</tr>
</table>
<p>If we wanted to make it easier to create custom basic shapes, we could
certainly add another layer between the 3D primitives and rendering, but
this was not the aim here. Even without that, you can see that having multiple
levels of abstraction has important benefits. The most obvious one is that you
can easily move from a higher level to a lower level to explore how things are created
(say, how <code>tower</code> is constructed from <code>cone</code> and <code>cylinder</code>) and use the lower-level
primitives in a different way.</p>
<p>In other words, if you implemented <code>tower</code> as a
function that directly calls OpenGL, you could hardly provide enough overloads
(and optional parameters) to capture all possible kinds of towers that someone
might want to create. But if your library has multiple levels of abstraction, this
is not a problem.</p>
<h2>Demo #3: Documentation generation</h2>
<p>The examples I discussed so far may look like special libraries - one was a core
functional library with just two levels and another was specifically designed as
a domain-specific language. To convince you that this approach is valuable <em>in general</em>,
I'll look at one more example, this time from the <a href="http://tpetricek.github.io/FSharp.Formatting/">F# Formatting library</a>.</p>
<p>The library consists of a Markdown parser and F# code formatter (and is used by
most F# projects around). The most common scenario for using the library is to turn
a folder with Markdown files and F# Script files into an output folder with generated
HTML documentation. This is what the <a href="https://github.com/fsprojects/ProjectScaffold/blob/master/docs/tools/generate.template#L104">ProjectScaffold template does</a>.</p>
<h3>High-level: Processing directories</h3>
<p>So assuming <code>webHome</code> is a folder with Markdown files (like the
<a href="https://github.com/fsharp/fsfoundation/tree/gh-pages/guides">F# Foundation guides</a>), we can
generate HTML documentation just by calling <code>Literate.ProcessDirectory</code>:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs89', 230)" onmouseover="showTip(event, 'fs89', 230)" class="t">Literate</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 231)" onmouseover="showTip(event, 'fs90', 231)" class="f">ProcessDirectory</span>
  ( <span class="i">inputDirectory</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs39', 232)" onmouseover="showTip(event, 'fs39', 232)" class="i">webHome</span>, 
    <span class="i">outputDirectory</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs40', 233)" onmouseover="showTip(event, 'fs40', 233)" class="i">webOutput</span>, 
    <span class="i">processRecursive</span><span class="o">=</span><span class="k">true</span> )
</code></pre></td>
</tr>
</table>
<p>This is the high-level version of the API provided by the library and also the code that
you'll need to write in 80% of cases. The <code>ProcessDirectory</code> has a number of arguments that
let you specify how the processing is done (such as a template file, F# Compiler instance
for colorization of snippets etc.)</p>
<p>However, it does not let you customize which files in the directory are processed and it
does not let you perform any transformations on the individual files. For that, we need
to look at the lower-level API.</p>
<h3>Medium-level: Processing individual files</h3>
<p>For an example, let's say that we don't want to look at Markdown files in a local folder,
but instead we want to crawl the <a href="https://github.com/fsharp/fsfoundation/tree/gh-pages/guides">guides directory</a>
of the F# Foundation page directly from GitHub. To do this, we'll use the GitHub API
(to get a list of folders and files in them). Using the <a href="http://fsharp.github.io/FSharp.Data/library/JsonProvider.html">JSON type provider</a>,
we start with a function that returns the result of GitHub contents query:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs34', 234)" onmouseover="showTip(event, 'fs34', 234)" class="i">FSharp</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs91', 235)" onmouseover="showTip(event, 'fs91', 235)" class="i">Data</span>

<span class="c">/// Type representing returned JSON, inferred from a sample</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs92', 236)" onmouseover="showTip(event, 'fs92', 236)" class="t">GitHubDir</span> <span class="o">=</span> <span class="i">JsonProvider</span><span class="o">&lt;</span><span class="s">&quot;../data/repos.json&quot;</span><span class="o">&gt;</span>

<span class="c">/// Query the contents of a specified &#39;dir&#39; in a &#39;repo&#39;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs93', 237)" onmouseover="showTip(event, 'fs93', 237)" class="f">queryDir</span> <span onmouseout="hideTip(event, 'fs94', 238)" onmouseover="showTip(event, 'fs94', 238)" class="i">repo</span> <span onmouseout="hideTip(event, 'fs95', 239)" onmouseover="showTip(event, 'fs95', 239)" class="i">dir</span> <span class="o">=</span>
  <span class="i">Http</span><span class="o">.</span><span class="i">RequestString</span>
    ( <span onmouseout="hideTip(event, 'fs96', 240)" onmouseover="showTip(event, 'fs96', 240)" class="i">sprintf</span> <span class="s">&quot;%s/repos/%s/contents/%s?anon=1&quot;</span> <span onmouseout="hideTip(event, 'fs42', 241)" onmouseover="showTip(event, 'fs42', 241)" class="i">api</span> <span onmouseout="hideTip(event, 'fs94', 242)" onmouseover="showTip(event, 'fs94', 242)" class="i">repo</span> <span onmouseout="hideTip(event, 'fs95', 243)" onmouseover="showTip(event, 'fs95', 243)" class="i">dir</span>,
      <span class="i">headers</span> <span class="o">=</span> [<span class="i">HttpRequestHeaders</span><span class="o">.</span><span class="i">UserAgent</span> <span class="s">&quot;My App&quot;</span>] )
  <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs92', 244)" onmouseover="showTip(event, 'fs92', 244)" class="i">GitHubDir</span><span class="o">.</span><span class="i">Parse</span>
</code></pre></td>
</tr>
</table>
<p>Now, we can use <code>queryDir</code> to get all sub-directories in the "guides" folder and
then get all the files under each guide. We can then process each file using the
medium-level <code>Literate.ProcessMarkdown</code> function:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Iterate over all Markdown guides on fsharp.org</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs97', 245)" onmouseover="showTip(event, 'fs97', 245)" class="i">wc</span> <span class="o">=</span> <span class="k">new</span> <span onmouseout="hideTip(event, 'fs1', 246)" onmouseover="showTip(event, 'fs1', 246)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs98', 247)" onmouseover="showTip(event, 'fs98', 247)" class="i">Net</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs99', 248)" onmouseover="showTip(event, 'fs99', 248)" class="t">WebClient</span>()
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs100', 249)" onmouseover="showTip(event, 'fs100', 249)" class="i">guides</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs93', 250)" onmouseover="showTip(event, 'fs93', 250)" class="f">queryDir</span> <span class="s">&quot;fsharp/fsfoundation&quot;</span> <span class="s">&quot;guides&quot;</span>
<span class="k">for</span> <span onmouseout="hideTip(event, 'fs101', 251)" onmouseover="showTip(event, 'fs101', 251)" class="i">subdir</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs100', 252)" onmouseover="showTip(event, 'fs100', 252)" class="i">guides</span> <span class="k">do</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs102', 253)" onmouseover="showTip(event, 'fs102', 253)" class="i">files</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs93', 254)" onmouseover="showTip(event, 'fs93', 254)" class="f">queryDir</span> <span class="s">&quot;fsharp/fsfoundation&quot;</span> (<span class="s">&quot;guides/&quot;</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs101', 255)" onmouseover="showTip(event, 'fs101', 255)" class="i">subdir</span><span class="o">.</span><span class="i">Name</span>)
  <span class="k">for</span> <span onmouseout="hideTip(event, 'fs103', 256)" onmouseover="showTip(event, 'fs103', 256)" class="i">file</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs102', 257)" onmouseover="showTip(event, 'fs102', 257)" class="i">files</span> <span class="k">do</span>
    <span class="c">// Downloda the guide to a local Temp file</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs104', 258)" onmouseover="showTip(event, 'fs104', 258)" class="i">tempFile</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs105', 259)" onmouseover="showTip(event, 'fs105', 259)" class="t">Path</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs106', 260)" onmouseover="showTip(event, 'fs106', 260)" class="f">GetTempFileName</span>()
    <span onmouseout="hideTip(event, 'fs97', 261)" onmouseover="showTip(event, 'fs97', 261)" class="i">wc</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs107', 262)" onmouseover="showTip(event, 'fs107', 262)" class="f">DownloadFile</span>(<span onmouseout="hideTip(event, 'fs41', 263)" onmouseover="showTip(event, 'fs41', 263)" class="i">root</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs101', 264)" onmouseover="showTip(event, 'fs101', 264)" class="i">subdir</span><span class="o">.</span><span class="i">Name</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs103', 265)" onmouseover="showTip(event, 'fs103', 265)" class="i">file</span><span class="o">.</span><span class="i">Name</span>, <span onmouseout="hideTip(event, 'fs104', 266)" onmouseover="showTip(event, 'fs104', 266)" class="i">tempFile</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs108', 267)" onmouseover="showTip(event, 'fs108', 267)" class="i">dir</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs105', 268)" onmouseover="showTip(event, 'fs105', 268)" class="t">Path</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs109', 269)" onmouseover="showTip(event, 'fs109', 269)" class="f">Combine</span>(<span onmouseout="hideTip(event, 'fs40', 270)" onmouseover="showTip(event, 'fs40', 270)" class="i">webOutput</span>, <span onmouseout="hideTip(event, 'fs101', 271)" onmouseover="showTip(event, 'fs101', 271)" class="i">subdir</span><span class="o">.</span><span class="i">Name</span>)
    <span onmouseout="hideTip(event, 'fs110', 272)" onmouseover="showTip(event, 'fs110', 272)" class="t">Directory</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs111', 273)" onmouseover="showTip(event, 'fs111', 273)" class="f">CreateDirectory</span>(<span onmouseout="hideTip(event, 'fs108', 274)" onmouseover="showTip(event, 'fs108', 274)" class="i">dir</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs112', 275)" onmouseover="showTip(event, 'fs112', 275)" class="f">ignore</span>
    <span class="c">// Process the guide using medium-level API</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs113', 276)" onmouseover="showTip(event, 'fs113', 276)" class="i">out</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs105', 277)" onmouseover="showTip(event, 'fs105', 277)" class="t">Path</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs114', 278)" onmouseover="showTip(event, 'fs114', 278)" class="f">ChangeExtension</span>(<span onmouseout="hideTip(event, 'fs105', 279)" onmouseover="showTip(event, 'fs105', 279)" class="t">Path</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs109', 280)" onmouseover="showTip(event, 'fs109', 280)" class="f">Combine</span>(<span onmouseout="hideTip(event, 'fs108', 281)" onmouseover="showTip(event, 'fs108', 281)" class="i">dir</span>, <span onmouseout="hideTip(event, 'fs103', 282)" onmouseover="showTip(event, 'fs103', 282)" class="i">file</span><span class="o">.</span><span class="i">Name</span>), <span class="s">&quot;.html&quot;</span>)
    <span onmouseout="hideTip(event, 'fs89', 283)" onmouseover="showTip(event, 'fs89', 283)" class="t">Literate</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs115', 284)" onmouseover="showTip(event, 'fs115', 284)" class="f">ProcessMarkdown</span>(<span onmouseout="hideTip(event, 'fs104', 285)" onmouseover="showTip(event, 'fs104', 285)" class="i">tempFile</span>, <span class="i">output</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs113', 286)" onmouseover="showTip(event, 'fs113', 286)" class="i">out</span>)
</code></pre></td>
</tr>
</table>
<p>So far, we replaced the default behaviour for processing directories with our own
custom behaviour for crawling documents on GitHub. This looks quite simple - which
is the point of the library! But imagine some alternative approaches that you could
use here.</p>
<blockquote>
<p><strong>Non-example: Abstracting directories with interfaces</strong></p>
<p>If you were solving this problem in an object-oriented style, you might try to
design an interface that models "directory structure browser" or something like
that. The <code>Literate.ProcessDirectory</code> method would then take <code>IDirectoryBrowser</code>.</p>
<p>Your <code>IDirectoryBrowser</code> would have methods <code>GetSubDirectories</code> and <code>GetFiles</code> and
default implementation walking over file structure. You could then implement it
differently using the GitHub API.</p>
<p>The problem with this is that it inverts the control - rather than being a <em>library</em>
that you can call to do things you want, it becomes a <em>framework</em> that dictates
what you need to provide. And if you need something else, then you're out of luck!
For example, if you suddenly wanted to process documents that do not naturally fit
into a tree structure, the <code>IDirectoryBrowser</code> abstraction would break. With a
library that provides multiple levels of abstraction, this is not a problem, because
<em>you</em> are in control.</p>
</blockquote>
<p>So far, we looked at processing whole directories and individual files, but there is one
more level we can look at...</p>
<h3>Low-level: Transforming documents</h3>
<p>Now, let's say that we wanted to perform some transformation on the documents as part of
the processing. If you're using something like Jekyll (on GitHub), then the way to do this
is to use <a href="http://jekyllrb.com/docs/plugins/">Jekyll plugins</a>. There are four kinds of
plugins (generators, converters, commands and tags) - so, no matter what you're doing, it
will have to fit into one of the patterns (interfaces) that Jekyll developers expect you
to use.</p>
<p>In F# Formatting, we again avoid using inversion of control caused by interfaces (or plugins).
Instead, you can look one level deeper and access the data structure that represents the
parsed Markdown and perform some transformation on the structure.</p>
<p>Let's say that we are currently processing a file <code>guide</code>. Rather than using <code>Literate.ProcessMarkdown</code>,
we can call <code>Literate.ParseMarkdownFile</code>, which gives us the result of parsing (first of the
two steps that processing does):</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Parse the Literate Markdown file</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs116', 287)" onmouseover="showTip(event, 'fs116', 287)" class="i">doc</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs89', 288)" onmouseover="showTip(event, 'fs89', 288)" class="t">Literate</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs117', 289)" onmouseover="showTip(event, 'fs117', 289)" class="f">ParseMarkdownFile</span>(<span onmouseout="hideTip(event, 'fs38', 290)" onmouseover="showTip(event, 'fs38', 290)" class="i">guide</span>)

<span class="c">/// Helper function that collects headers</span>
<span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs118', 291)" onmouseover="showTip(event, 'fs118', 291)" class="f">collectHeaders</span> <span class="o">=</span> <span class="k">function</span>
  | <span onmouseout="hideTip(event, 'fs119', 292)" onmouseover="showTip(event, 'fs119', 292)" class="p">Heading</span>(<span onmouseout="hideTip(event, 'fs120', 293)" onmouseover="showTip(event, 'fs120', 293)" class="i">level</span>, <span onmouseout="hideTip(event, 'fs121', 294)" onmouseover="showTip(event, 'fs121', 294)" class="i">content</span>) <span class="k">-&gt;</span> [<span onmouseout="hideTip(event, 'fs120', 295)" onmouseover="showTip(event, 'fs120', 295)" class="i">level</span>, <span onmouseout="hideTip(event, 'fs121', 296)" onmouseover="showTip(event, 'fs121', 296)" class="i">content</span>]
  | <span onmouseout="hideTip(event, 'fs122', 297)" onmouseover="showTip(event, 'fs122', 297)" class="t">Matching</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs123', 298)" onmouseover="showTip(event, 'fs123', 298)" class="p">ParagraphNested</span>(_, <span onmouseout="hideTip(event, 'fs124', 299)" onmouseover="showTip(event, 'fs124', 299)" class="i">pars</span>) <span class="k">-&gt;</span>
      <span onmouseout="hideTip(event, 'fs124', 300)" onmouseover="showTip(event, 'fs124', 300)" class="i">pars</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs68', 301)" onmouseover="showTip(event, 'fs68', 301)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs125', 302)" onmouseover="showTip(event, 'fs125', 302)" class="f">concat</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs68', 303)" onmouseover="showTip(event, 'fs68', 303)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs126', 304)" onmouseover="showTip(event, 'fs126', 304)" class="f">collect</span> <span onmouseout="hideTip(event, 'fs118', 305)" onmouseover="showTip(event, 'fs118', 305)" class="f">collectHeaders</span>
  | _ <span class="k">-&gt;</span> []

<span class="c">// Returns a list of headings with their level</span>
<span onmouseout="hideTip(event, 'fs116', 306)" onmouseover="showTip(event, 'fs116', 306)" class="i">doc</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs127', 307)" onmouseover="showTip(event, 'fs127', 307)" class="i">Paragraphs</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs68', 308)" onmouseover="showTip(event, 'fs68', 308)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs126', 309)" onmouseover="showTip(event, 'fs126', 309)" class="f">collect</span> <span onmouseout="hideTip(event, 'fs118', 310)" onmouseover="showTip(event, 'fs118', 310)" class="f">collectHeaders</span>
</code></pre></td>
</tr>
</table>
<p>The low level of the API is now starting to look similar to the list processing function in the
first example. We get the paragraphs of the document as a value of the <code>MarkdownParagraphs</code> type
and we can pattern match on it. The pattern matching uses active patterns, so we do not need
to handle all possible kinds of paragraphs, but just the one we are interested in (<code>Heading</code>) and
one that represents nesting (you can find more about this pattern in Chapter 3 of <a href="http://manning.com/petricek2/">F# Deep Dives</a>).</p>
<p>Now that we have the headings, we can generate new Markdown paragraphs representing
the <code>&lt;ol&gt;</code> element with the table of contents and create a new document that includes
the TOC as an additional part of the body:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// Generates Markdown nodes with the TOC</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs128', 311)" onmouseover="showTip(event, 'fs128', 311)" class="f">generateToc</span> <span onmouseout="hideTip(event, 'fs129', 312)" onmouseover="showTip(event, 'fs129', 312)" class="i">items</span> <span class="o">=</span> 
  <span class="c">/// Split the given list of &#39;items&#39; into the first node,</span>
  <span class="c">/// its children (following items with larger level) and </span>
  <span class="c">/// process the remaining items recursively.</span>
  <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs130', 313)" onmouseover="showTip(event, 'fs130', 313)" class="f">getChildren</span> <span onmouseout="hideTip(event, 'fs131', 314)" onmouseover="showTip(event, 'fs131', 314)" class="i">acc</span> <span onmouseout="hideTip(event, 'fs132', 315)" onmouseover="showTip(event, 'fs132', 315)" class="i">items</span> <span class="o">=</span> 
    <span id="fst133" onmouseout="hideTip(event, 'fs133', 316)" onmouseover="showTip(event, 'fs133', 316, document.getElementById('fst133'))" class="omitted">(Implementation hidden)</span>
  <span onmouseout="hideTip(event, 'fs130', 317)" onmouseover="showTip(event, 'fs130', 317)" class="f">getChildren</span> [] <span onmouseout="hideTip(event, 'fs132', 318)" onmouseover="showTip(event, 'fs132', 318)" class="i">items</span>

<span class="c">// Generate new Markdown content</span>
<span class="c">// (collect all headers &amp; generate TOC)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs134', 319)" onmouseover="showTip(event, 'fs134', 319)" class="i">tocPars</span> <span class="o">=</span> 
  <span onmouseout="hideTip(event, 'fs116', 320)" onmouseover="showTip(event, 'fs116', 320)" class="i">doc</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs127', 321)" onmouseover="showTip(event, 'fs127', 321)" class="i">Paragraphs</span> 
  <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs68', 322)" onmouseover="showTip(event, 'fs68', 322)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs126', 323)" onmouseover="showTip(event, 'fs126', 323)" class="f">collect</span> <span onmouseout="hideTip(event, 'fs118', 324)" onmouseover="showTip(event, 'fs118', 324)" class="f">collectHeaders</span>
  <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs128', 325)" onmouseover="showTip(event, 'fs128', 325)" class="f">generateToc</span>

<span class="c">// Create document with additional paragraphs</span>
<span class="c">// (for the TOC) and format it as HTML</span>
<span onmouseout="hideTip(event, 'fs116', 326)" onmouseover="showTip(event, 'fs116', 326)" class="i">doc</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs135', 327)" onmouseover="showTip(event, 'fs135', 327)" class="f">With</span>(<span onmouseout="hideTip(event, 'fs68', 328)" onmouseover="showTip(event, 'fs68', 328)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs136', 329)" onmouseover="showTip(event, 'fs136', 329)" class="f">append</span> <span onmouseout="hideTip(event, 'fs134', 330)" onmouseover="showTip(event, 'fs134', 330)" class="i">tocPars</span> <span onmouseout="hideTip(event, 'fs116', 331)" onmouseover="showTip(event, 'fs116', 331)" class="i">doc</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs127', 332)" onmouseover="showTip(event, 'fs127', 332)" class="i">Paragraphs</span>)
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs89', 333)" onmouseover="showTip(event, 'fs89', 333)" class="t">Literate</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs137', 334)" onmouseover="showTip(event, 'fs137', 334)" class="f">WriteHtml</span>
</code></pre></td>
</tr>
</table>
<p>Just like in the example with processing lists, we could now identify a more
general pattern and provide a higher-level function that encapsulates the behaviour.
But having <em>access</em> to the lower-level API means that we are not limited to a couple
of functions that the library developers thought of! Instead, we can always switch
to the lower-level API when there is something we want to do that is not directly
exposed at the higher-level.</p>
<h2>Summary</h2>
<p>In this article, I talked about one of the design patterns that I find useful when
designing libraries in functional style. The idea of the pattern is quite simple.</p>
<h3>Levels of abstraction pattern</h3>
<p>In your library, you should provide high-level functions that handle 80% of the tasks
that your users need. For the next 15% of tasks, the library should provide a lower-level
API. The key point is that the high-level API should be easy to express in terms
of the lower-level API. This means that one should be able to "unroll" the single
higher-level call into code that composes a couple of lower-level calls and customize
the code to do whatever is needed. Then, you should be able to "fold" the lower-level
code back into a new reusable higher-level operation.</p>
<p>I demonstrated this using three examples - when working with functional lists, you can
"unroll" higher-order functions to recursive processing and pattern matching; when
composing 3D graphics, you can "unroll" concepts such as tower or wall into primitive
objects like cubes. Finally, the documentation generation library F# Formatting lets
you do the same thing. You can "unroll" code that processes entire folder into calls
to process individual files - and even further, you can "unroll" processing and insert
custom code between the parsing and rendering phases.</p>
<h3>Benefits of the pattern</h3>
<p>Why would you design libraries in this way? I discussed some of the advantages along the
way - but the key point is that libraries with multiple levels of abstraction make the
most common 80% of tasks really easy. But they also do not restrict the remaining tasks
to what the author of the library could imagine when designing it. Instead, you are
giving the library users the power to use it in interesting ways and customize it to
their needs.</p>
<p>In case of F# Formatting, this already paid off - the high-level API is used by many
F# open-source projects through <a href="https://github.com/fsprojects/ProjectScaffold/">ProjectScaffold</a>, but
the low-level API provides enough flexibility for amazing tools like <a href="http://fsprojects.github.io/FsReveal/">FsReveal</a>.</p>


<div class="tip" id="fs1">namespace System</div>
<div class="tip" id="fs2">namespace System.Drawing</div>
<div class="tip" id="fs3">module Functional3D</div>
<div class="tip" id="fs4">namespace OpenTK</div>
<div class="tip" id="fs5">namespace OpenTK.Graphics</div>
<div class="tip" id="fs6">namespace OpenTK.Graphics.OpenGL</div>
<div class="tip" id="fs7">val tower : x:float -&gt; z:float -&gt; Drawing3D<br /><br />Full name: Library-layers.tower</div>
<div class="tip" id="fs8">val x : float</div>
<div class="tip" id="fs9">val z : float</div>
<div class="tip" id="fs10">module Fun<br /><br />from Functional3D</div>
<div class="tip" id="fs11">val cylinder : Drawing3D<br /><br />Full name: Functional3D.Fun.cylinder<br /><em><br /><br />&#160;Generates a 3D cylinder object of a unit size</em></div>
<div class="tip" id="fs12">val scale : x:float * y:float * z:float -&gt; Drawing3D -&gt; Drawing3D<br /><br />Full name: Functional3D.Fun.scale<br /><em><br /><br />&#160;Scale the specified 3D object by the specified scales along the 3 axes</em></div>
<div class="tip" id="fs13">val translate : x:float * y:float * z:float -&gt; Drawing3D -&gt; Drawing3D<br /><br />Full name: Functional3D.Fun.translate<br /><em><br /><br />&#160;Move the specified object by the provided offsets</em></div>
<div class="tip" id="fs14">val color : clr:Color -&gt; Drawing3D -&gt; Drawing3D<br /><br />Full name: Functional3D.Fun.color<br /><em><br /><br />&#160;Set color to be used when drawing the specified 3D objects</em></div>
<div class="tip" id="fs15">type Color =<br />&#160;&#160;struct<br />&#160;&#160;&#160;&#160;member A : byte<br />&#160;&#160;&#160;&#160;member B : byte<br />&#160;&#160;&#160;&#160;member Equals : obj:obj -&gt; bool<br />&#160;&#160;&#160;&#160;member G : byte<br />&#160;&#160;&#160;&#160;member GetBrightness : unit -&gt; float32<br />&#160;&#160;&#160;&#160;member GetHashCode : unit -&gt; int<br />&#160;&#160;&#160;&#160;member GetHue : unit -&gt; float32<br />&#160;&#160;&#160;&#160;member GetSaturation : unit -&gt; float32<br />&#160;&#160;&#160;&#160;member IsEmpty : bool<br />&#160;&#160;&#160;&#160;member IsKnownColor : bool<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: System.Drawing.Color</div>
<div class="tip" id="fs16">property Color.DarkGoldenrod: Color</div>
<div class="tip" id="fs17">val cone : Drawing3D<br /><br />Full name: Functional3D.Fun.cone<br /><em><br /><br />&#160;Generate the sphere <br />&#160;Generates a 3D cylinder object of a unit size</em></div>
<div class="tip" id="fs18">property Color.Red: Color</div>
<div class="tip" id="fs19">val rotate : x:float * y:float * z:float -&gt; Drawing3D -&gt; Drawing3D<br /><br />Full name: Functional3D.Fun.rotate<br /><em><br /><br />&#160;Scale the specified 3D object by the specified scales along the 3 axes</em></div>
<div class="tip" id="fs20">val sizedCube : height:float -&gt; Drawing3D<br /><br />Full name: Library-layers.sizedCube</div>
<div class="tip" id="fs21">val height : float</div>
<div class="tip" id="fs22">val cube : Drawing3D<br /><br />Full name: Functional3D.Fun.cube<br /><em><br /><br />&#160;Creates a 3D cube of unit size using the current color</em></div>
<div class="tip" id="fs23">val twoCubes : Drawing3D<br /><br />Full name: Library-layers.twoCubes</div>
<div class="tip" id="fs24">val block : Drawing3D<br /><br />Full name: Library-layers.block</div>
<div class="tip" id="fs25">val offset : float</div>
<div class="tip" id="fs26">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs27">val reduce : reduction:(&#39;T -&gt; &#39;T -&gt; &#39;T) -&gt; source:seq&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Collections.Seq.reduce</div>
<div class="tip" id="fs28">property Color.DarkGray: Color</div>
<div class="tip" id="fs29">val wall : offs:float -&gt; rotate:bool -&gt; Drawing3D<br /><br />Full name: Library-layers.wall</div>
<div class="tip" id="fs30">val offs : float</div>
<div class="tip" id="fs31">val rotate : bool</div>
<div class="tip" id="fs32">val rotationArg : float * float * float</div>
<div class="tip" id="fs33">val translationArg : float * float * float</div>
<div class="tip" id="fs34">Multiple items<br />namespace FSharp<br /><br />--------------------<br />namespace Microsoft.FSharp</div>
<div class="tip" id="fs35">namespace FSharp.Literate</div>
<div class="tip" id="fs36">namespace FSharp.Markdown</div>
<div class="tip" id="fs37">namespace System.IO</div>
<div class="tip" id="fs38">val guide : string<br /><br />Full name: Library-layers.guide</div>
<div class="tip" id="fs39">val webHome : string<br /><br />Full name: Library-layers.webHome</div>
<div class="tip" id="fs40">val webOutput : string<br /><br />Full name: Library-layers.webOutput</div>
<div class="tip" id="fs41">val root : string<br /><br />Full name: Library-layers.root</div>
<div class="tip" id="fs42">val api : string<br /><br />Full name: Library-layers.api</div>
<div class="tip" id="fs43">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member GetSlice : startIndex:int option * endIndex:int option -&gt; &#39;T list<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs44">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.map</div>
<div class="tip" id="fs45">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float<br /><br />--------------------<br />type float = Double<br /><br />Full name: Microsoft.FSharp.Core.float<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float<br /><br />Full name: Microsoft.FSharp.Core.float&lt;_&gt;</div>
<div class="tip" id="fs46">val sin : value:&#39;T -&gt; &#39;T (requires member Sin)<br /><br />Full name: Microsoft.FSharp.Core.Operators.sin</div>
<div class="tip" id="fs47">val filter : predicate:(&#39;T -&gt; bool) -&gt; list:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.filter</div>
<div class="tip" id="fs48">val n : float</div>
<div class="tip" id="fs49">val splitAtSignChange : list:&#39;a list -&gt; &#39;a list * &#39;a list (requires member get_Sign)<br /><br />Full name: Library-layers.splitAtSignChange<br /><em><br /><br />&#160;Split a list at the point where the <br />&#160;sign of adjacent elements changes</em></div>
<div class="tip" id="fs50">Multiple items<br />val list : &#39;a list (requires member get_Sign)<br /><br />--------------------<br />type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs51">val loop : (&#39;a -&gt; &#39;a list -&gt; &#39;a list -&gt; &#39;a list * &#39;a list) (requires member get_Sign)</div>
<div class="tip" id="fs52">val last : &#39;a (requires member get_Sign)</div>
<div class="tip" id="fs53">val acc : &#39;a list (requires member get_Sign)</div>
<div class="tip" id="fs54">val rev : list:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.rev</div>
<div class="tip" id="fs55">val first : &#39;a (requires member get_Sign)</div>
<div class="tip" id="fs56">val tail : &#39;a list (requires member get_Sign)</div>
<div class="tip" id="fs57">val sign : value:&#39;T -&gt; int (requires member get_Sign)<br /><br />Full name: Microsoft.FSharp.Core.Operators.sign</div>
<div class="tip" id="fs58">val head : &#39;a (requires member get_Sign)</div>
<div class="tip" id="fs59">val splitAt : f:(&#39;a -&gt; &#39;a -&gt; bool) -&gt; list:&#39;a list -&gt; &#39;a list * &#39;a list<br /><br />Full name: Library-layers.List.splitAt<br /><em><br /><br />&#160;Splits a list into two when the predicate &#39;f&#39;<br />&#160;returns &#39;true&#39; on two adjacent elements of the list</em></div>
<div class="tip" id="fs60">val f : (&#39;a -&gt; &#39;a -&gt; bool)</div>
<div class="tip" id="fs61">Multiple items<br />val list : &#39;a list<br /><br />--------------------<br />type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs62">val loop : (&#39;a -&gt; &#39;a list -&gt; &#39;a list -&gt; &#39;a list * &#39;a list)</div>
<div class="tip" id="fs63">val last : &#39;a</div>
<div class="tip" id="fs64">val acc : &#39;a list</div>
<div class="tip" id="fs65">val first : &#39;a</div>
<div class="tip" id="fs66">val tail : &#39;a list</div>
<div class="tip" id="fs67">val head : &#39;a</div>
<div class="tip" id="fs68">Multiple items<br />module List<br /><br />from Library-layers<br /><br />--------------------<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member GetSlice : startIndex:int option * endIndex:int option -&gt; &#39;T list<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs69">Multiple items<br />val splitAt : f:(&#39;a -&gt; &#39;a -&gt; bool) -&gt; list:&#39;a list -&gt; &#39;a list * &#39;a list<br /><br />Full name: Library-layers.List.splitAt<br /><em><br /><br />&#160;Splits a list into two when the predicate &#39;f&#39;<br />&#160;returns &#39;true&#39; on two adjacent elements of the list</em><br /><br />--------------------<br />val splitAt : index:int -&gt; list:&#39;T list -&gt; &#39;T list * &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.splitAt</div>
<div class="tip" id="fs70">val a : float</div>
<div class="tip" id="fs71">val b : float</div>
<div class="tip" id="fs72">val cube : Drawing3D<br /><br />Full name: Library-layers.cube</div>
<div class="tip" id="fs73">union case Drawing3D.DF: (Drawing3DContext -&gt; unit) -&gt; Drawing3D</div>
<div class="tip" id="fs74">val ctx : Drawing3DContext</div>
<div class="tip" id="fs75">Multiple items<br />type GL =<br />&#160;&#160;inherit GraphicsBindingsBase<br />&#160;&#160;new : unit -&gt; GL<br />&#160;&#160;static member Accum : op:AccumOp * value:float32 -&gt; unit<br />&#160;&#160;static member ActiveShaderProgram : pipeline:int * program:int -&gt; unit + 1 overload<br />&#160;&#160;static member ActiveTexture : texture:TextureUnit -&gt; unit<br />&#160;&#160;static member AlphaFunc : func:AlphaFunction * ref:float32 -&gt; unit<br />&#160;&#160;static member AreTexturesResident : n:int * textures:int[] * residences:bool[] -&gt; bool + 5 overloads<br />&#160;&#160;static member ArrayElement : i:int -&gt; unit<br />&#160;&#160;static member AttachShader : program:int * shader:int -&gt; unit + 1 overload<br />&#160;&#160;static member Begin : mode:BeginMode -&gt; unit + 1 overload<br />&#160;&#160;static member BeginConditionalRender : id:int * mode:ConditionalRenderType -&gt; unit + 1 overload<br />&#160;&#160;...<br />&#160;&#160;nested type Amd<br />&#160;&#160;nested type Apple<br />&#160;&#160;nested type Arb<br />&#160;&#160;nested type Ati<br />&#160;&#160;nested type Ext<br />&#160;&#160;nested type GL_3dfx<br />&#160;&#160;nested type Gremedy<br />&#160;&#160;nested type HP<br />&#160;&#160;nested type Ibm<br />&#160;&#160;nested type Ingr<br />&#160;&#160;nested type Intel<br />&#160;&#160;nested type Khr<br />&#160;&#160;nested type Mesa<br />&#160;&#160;nested type NV<br />&#160;&#160;nested type Nvx<br />&#160;&#160;nested type Oes<br />&#160;&#160;nested type Pgi<br />&#160;&#160;nested type Sgi<br />&#160;&#160;nested type Sgis<br />&#160;&#160;nested type Sgix<br />&#160;&#160;nested type Sun<br />&#160;&#160;nested type Sunx<br /><br />Full name: OpenTK.Graphics.OpenGL.GL<br /><br />--------------------<br />GL() : unit</div>
<div class="tip" id="fs76">GL.Material(face: MaterialFace, pname: MaterialParameter, params: Color4) : unit<br />GL.Material(face: MaterialFace, pname: MaterialParameter, params: Vector4) : unit<br />GL.Material(face: MaterialFace, pname: MaterialParameter, params: nativeptr&lt;int&gt;) : unit<br />GL.Material(face: MaterialFace, pname: MaterialParameter, params: int []) : unit<br />GL.Material(face: MaterialFace, pname: MaterialParameter, param: int) : unit<br />GL.Material(face: MaterialFace, pname: MaterialParameter, params: nativeptr&lt;float32&gt;) : unit<br />GL.Material(face: MaterialFace, pname: MaterialParameter, params: float32 []) : unit<br />GL.Material(face: MaterialFace, pname: MaterialParameter, param: float32) : unit</div>
<div class="tip" id="fs77">type MaterialFace =<br />&#160;&#160;| Front = 1028<br />&#160;&#160;| Back = 1029<br />&#160;&#160;| FrontAndBack = 1032<br /><br />Full name: OpenTK.Graphics.OpenGL.MaterialFace</div>
<div class="tip" id="fs78">field MaterialFace.FrontAndBack = 1032</div>
<div class="tip" id="fs79">type MaterialParameter =<br />&#160;&#160;| Ambient = 4608<br />&#160;&#160;| Diffuse = 4609<br />&#160;&#160;| Specular = 4610<br />&#160;&#160;| Emission = 5632<br />&#160;&#160;| Shininess = 5633<br />&#160;&#160;| AmbientAndDiffuse = 5634<br />&#160;&#160;| ColorIndexes = 5635<br /><br />Full name: OpenTK.Graphics.OpenGL.MaterialParameter</div>
<div class="tip" id="fs80">field MaterialParameter.Diffuse = 4609</div>
<div class="tip" id="fs81">Drawing3DContext.Color: Color4</div>
<div class="tip" id="fs82">GL.Begin(mode: PrimitiveType) : unit</div>
<div class="tip" id="fs83">type BeginMode =<br />&#160;&#160;| Points = 0<br />&#160;&#160;| Lines = 1<br />&#160;&#160;| LineLoop = 2<br />&#160;&#160;| LineStrip = 3<br />&#160;&#160;| Triangles = 4<br />&#160;&#160;| TriangleStrip = 5<br />&#160;&#160;| TriangleFan = 6<br />&#160;&#160;| Quads = 7<br />&#160;&#160;| QuadStrip = 8<br />&#160;&#160;| Polygon = 9<br />&#160;&#160;...<br /><br />Full name: OpenTK.Graphics.OpenGL.BeginMode</div>
<div class="tip" id="fs84">field BeginMode.Quads = 7</div>
<div class="tip" id="fs85">type GLEx =<br />&#160;&#160;static member Face : x:float32 * y:float32 * z:float32 -&gt; vertices:seq&lt;float32 * float32 * float32&gt; -&gt; unit<br />&#160;&#160;static member Vertices : vertices:seq&lt;float32 * float32 * float32&gt; -&gt; unit<br /><br />Full name: Functional3D.GLEx</div>
<div class="tip" id="fs86">static member GLEx.Face : x:float32 * y:float32 * z:float32 -&gt; vertices:seq&lt;float32 * float32 * float32&gt; -&gt; unit<br /><em><br /><br />&#160;Add mesh to the GL and set the specified normal vector first</em></div>
<div class="tip" id="fs87">GLEx.Face <br />&#160;&#160;&#160;&#160;( 1.f, 0.f, 0.f)<br />&#160;&#160;&#160;&#160;[ ( 0.5f, -0.5f, -0.5f); ( 0.5f, -0.5f,  0.5f);<br />&#160;&#160;&#160;&#160;&#160;&#160;( 0.5f,  0.5f,  0.5f); ( 0.5f,  0.5f, -0.5f) ]<br />&#160;&#160;GLEx.Face <br />&#160;&#160;&#160;&#160;(0.f, -1.f, 0.f)<br />&#160;&#160;&#160;&#160;[ (-0.5f, -0.5f, -0.5f); (-0.5f, -0.5f,  0.5f);<br />&#160;&#160;&#160;&#160;&#160;&#160;( 0.5f, -0.5f,  0.5f); ( 0.5f, -0.5f, -0.5f) ]<br />&#160;&#160;GLEx.Face <br />&#160;&#160;&#160;&#160;(0.f, 1.f, 0.f)<br />&#160;&#160;&#160;&#160;[ (-0.5f,  0.5f, -0.5f); (-0.5f,  0.5f,  0.5f);<br />&#160;&#160;&#160;&#160;&#160;&#160;( 0.5f,  0.5f,  0.5f); ( 0.5f,  0.5f, -0.5f) ]<br />&#160;&#160;GLEx.Face <br />&#160;&#160;&#160;&#160;(0.f, 0.f, -1.f)<br />&#160;&#160;&#160;&#160;[ (-0.5f, -0.5f, -0.5f); (-0.5f,  0.5f, -0.5f);<br />&#160;&#160;&#160;&#160;&#160;&#160;( 0.5f,  0.5f, -0.5f); ( 0.5f, -0.5f, -0.5f) ]<br />&#160;&#160;GLEx.Face <br />&#160;&#160;&#160;&#160;(0.f, 0.f, 1.f)<br />&#160;&#160;&#160;&#160;[ (-0.5f, -0.5f,  0.5f); (-0.5f,  0.5f,  0.5f);<br />&#160;&#160;&#160;&#160;&#160;&#160;( 0.5f,  0.5f,  0.5f); ( 0.5f, -0.5f,  0.5f) ]</div>
<div class="tip" id="fs88">GL.End() : unit</div>
<div class="tip" id="fs89">type Literate =<br />&#160;&#160;private new : unit -&gt; Literate<br />&#160;&#160;static member FormatLiterateNodes : doc:LiterateDocument * ?format:OutputKind * ?prefix:string * ?lineNumbers:bool * ?generateAnchors:bool -&gt; LiterateDocument<br />&#160;&#160;static member ParseMarkdownFile : path:string * ?formatAgent:CodeFormatAgent * ?compilerOptions:string * ?definedSymbols:#seq&lt;string&gt; * ?references:bool * ?fsiEvaluator:IFsiEvaluator -&gt; LiterateDocument<br />&#160;&#160;static member ParseMarkdownString : content:string * ?path:string * ?formatAgent:CodeFormatAgent * ?compilerOptions:string * ?definedSymbols:#seq&lt;string&gt; * ?references:bool * ?fsiEvaluator:IFsiEvaluator -&gt; LiterateDocument<br />&#160;&#160;static member ParseScriptFile : path:string * ?formatAgent:CodeFormatAgent * ?compilerOptions:string * ?definedSymbols:#seq&lt;string&gt; * ?references:bool * ?fsiEvaluator:IFsiEvaluator -&gt; LiterateDocument<br />&#160;&#160;static member ParseScriptString : content:string * ?path:string * ?formatAgent:CodeFormatAgent * ?compilerOptions:string * ?definedSymbols:#seq&lt;string&gt; * ?references:bool * ?fsiEvaluator:IFsiEvaluator -&gt; LiterateDocument<br />&#160;&#160;static member ProcessDirectory : inputDirectory:string * ?templateFile:string * ?outputDirectory:string * ?format:OutputKind * ?formatAgent:CodeFormatAgent * ?prefix:string * ?compilerOptions:string * ?lineNumbers:bool * ?references:bool * ?fsiEvaluator:IFsiEvaluator * ?replacements:(string * string) list * ?includeSource:bool * ?layoutRoots:string list * ?generateAnchors:bool * ?assemblyReferences:string list * ?processRecursive:bool -&gt; unit<br />&#160;&#160;static member ProcessMarkdown : input:string * ?templateFile:string * ?output:string * ?format:OutputKind * ?formatAgent:CodeFormatAgent * ?prefix:string * ?compilerOptions:string * ?lineNumbers:bool * ?references:bool * ?replacements:(string * string) list * ?includeSource:bool * ?layoutRoots:string list * ?generateAnchors:bool * ?assemblyReferences:string list -&gt; unit<br />&#160;&#160;static member ProcessScriptFile : input:string * ?templateFile:string * ?output:string * ?format:OutputKind * ?formatAgent:CodeFormatAgent * ?prefix:string * ?compilerOptions:string * ?lineNumbers:bool * ?references:bool * ?fsiEvaluator:IFsiEvaluator * ?replacements:(string * string) list * ?includeSource:bool * ?layoutRoots:string list * ?generateAnchors:bool * ?assemblyReferences:string list -&gt; unit<br />&#160;&#160;static member WriteHtml : doc:LiterateDocument * ?prefix:string * ?lineNumbers:bool * ?generateAnchors:bool -&gt; string<br />&#160;&#160;...<br /><br />Full name: FSharp.Literate.Literate</div>
<div class="tip" id="fs90">static member Literate.ProcessDirectory : inputDirectory:string * ?templateFile:string * ?outputDirectory:string * ?format:OutputKind * ?formatAgent:FSharp.CodeFormat.CodeFormatAgent * ?prefix:string * ?compilerOptions:string * ?lineNumbers:bool * ?references:bool * ?fsiEvaluator:IFsiEvaluator * ?replacements:(string * string) list * ?includeSource:bool * ?layoutRoots:string list * ?generateAnchors:bool * ?assemblyReferences:string list * ?processRecursive:bool -&gt; unit</div>
<div class="tip" id="fs91">namespace Microsoft.FSharp.Data</div>
<div class="tip" id="fs92">type GitHubDir = obj<br /><br />Full name: Library-layers.GitHubDir<br /><em><br /><br />&#160;Type representing returned JSON, inferred from a sample</em></div>
<div class="tip" id="fs93">val queryDir : repo:&#39;a -&gt; dir:&#39;b -&gt; &#39;c<br /><br />Full name: Library-layers.queryDir<br /><em><br /><br />&#160;Query the contents of a specified &#39;dir&#39; in a &#39;repo&#39;</em></div>
<div class="tip" id="fs94">val repo : &#39;a</div>
<div class="tip" id="fs95">val dir : &#39;b</div>
<div class="tip" id="fs96">val sprintf : format:Printf.StringFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.sprintf</div>
<div class="tip" id="fs97">val wc : Net.WebClient<br /><br />Full name: Library-layers.wc</div>
<div class="tip" id="fs98">namespace System.Net</div>
<div class="tip" id="fs99">Multiple items<br />type WebClient =<br />&#160;&#160;inherit Component<br />&#160;&#160;new : unit -&gt; WebClient<br />&#160;&#160;member BaseAddress : string with get, set<br />&#160;&#160;member CachePolicy : RequestCachePolicy with get, set<br />&#160;&#160;member CancelAsync : unit -&gt; unit<br />&#160;&#160;member Credentials : ICredentials with get, set<br />&#160;&#160;member DownloadData : address:string -&gt; byte[] + 1 overload<br />&#160;&#160;member DownloadDataAsync : address:Uri -&gt; unit + 1 overload<br />&#160;&#160;member DownloadFile : address:string * fileName:string -&gt; unit + 1 overload<br />&#160;&#160;member DownloadFileAsync : address:Uri * fileName:string -&gt; unit + 1 overload<br />&#160;&#160;member DownloadString : address:string -&gt; string + 1 overload<br />&#160;&#160;...<br /><br />Full name: System.Net.WebClient<br /><br />--------------------<br />Net.WebClient() : unit</div>
<div class="tip" id="fs100">val guides : seq&lt;obj&gt;<br /><br />Full name: Library-layers.guides</div>
<div class="tip" id="fs101">val subdir : obj</div>
<div class="tip" id="fs102">val files : seq&lt;obj&gt;</div>
<div class="tip" id="fs103">val file : obj</div>
<div class="tip" id="fs104">val tempFile : string</div>
<div class="tip" id="fs105">type Path =<br />&#160;&#160;static val DirectorySeparatorChar : char<br />&#160;&#160;static val AltDirectorySeparatorChar : char<br />&#160;&#160;static val VolumeSeparatorChar : char<br />&#160;&#160;static val InvalidPathChars : char[]<br />&#160;&#160;static val PathSeparator : char<br />&#160;&#160;static member ChangeExtension : path:string * extension:string -&gt; string<br />&#160;&#160;static member Combine : [&lt;ParamArray&gt;] paths:string[] -&gt; string + 3 overloads<br />&#160;&#160;static member GetDirectoryName : path:string -&gt; string<br />&#160;&#160;static member GetExtension : path:string -&gt; string<br />&#160;&#160;static member GetFileName : path:string -&gt; string<br />&#160;&#160;...<br /><br />Full name: System.IO.Path</div>
<div class="tip" id="fs106">Path.GetTempFileName() : string</div>
<div class="tip" id="fs107">Net.WebClient.DownloadFile(address: Uri, fileName: string) : unit<br />Net.WebClient.DownloadFile(address: string, fileName: string) : unit</div>
<div class="tip" id="fs108">val dir : string</div>
<div class="tip" id="fs109">Path.Combine([&lt;ParamArray&gt;] paths: string []) : string<br />Path.Combine(path1: string, path2: string) : string<br />Path.Combine(path1: string, path2: string, path3: string) : string<br />Path.Combine(path1: string, path2: string, path3: string, path4: string) : string</div>
<div class="tip" id="fs110">type Directory =<br />&#160;&#160;static member CreateDirectory : path:string -&gt; DirectoryInfo + 1 overload<br />&#160;&#160;static member Delete : path:string -&gt; unit + 1 overload<br />&#160;&#160;static member EnumerateDirectories : path:string -&gt; IEnumerable&lt;string&gt; + 2 overloads<br />&#160;&#160;static member EnumerateFileSystemEntries : path:string -&gt; IEnumerable&lt;string&gt; + 2 overloads<br />&#160;&#160;static member EnumerateFiles : path:string -&gt; IEnumerable&lt;string&gt; + 2 overloads<br />&#160;&#160;static member Exists : path:string -&gt; bool<br />&#160;&#160;static member GetAccessControl : path:string -&gt; DirectorySecurity + 1 overload<br />&#160;&#160;static member GetCreationTime : path:string -&gt; DateTime<br />&#160;&#160;static member GetCreationTimeUtc : path:string -&gt; DateTime<br />&#160;&#160;static member GetCurrentDirectory : unit -&gt; string<br />&#160;&#160;...<br /><br />Full name: System.IO.Directory</div>
<div class="tip" id="fs111">Directory.CreateDirectory(path: string) : DirectoryInfo<br />Directory.CreateDirectory(path: string, directorySecurity: Security.AccessControl.DirectorySecurity) : DirectoryInfo</div>
<div class="tip" id="fs112">val ignore : value:&#39;T -&gt; unit<br /><br />Full name: Microsoft.FSharp.Core.Operators.ignore</div>
<div class="tip" id="fs113">val out : string</div>
<div class="tip" id="fs114">Path.ChangeExtension(path: string, extension: string) : string</div>
<div class="tip" id="fs115">static member Literate.ProcessMarkdown : input:string * ?templateFile:string * ?output:string * ?format:OutputKind * ?formatAgent:FSharp.CodeFormat.CodeFormatAgent * ?prefix:string * ?compilerOptions:string * ?lineNumbers:bool * ?references:bool * ?replacements:(string * string) list * ?includeSource:bool * ?layoutRoots:string list * ?generateAnchors:bool * ?assemblyReferences:string list -&gt; unit</div>
<div class="tip" id="fs116">val doc : LiterateDocument<br /><br />Full name: Library-layers.doc</div>
<div class="tip" id="fs117">static member Literate.ParseMarkdownFile : path:string * ?formatAgent:FSharp.CodeFormat.CodeFormatAgent * ?compilerOptions:string * ?definedSymbols:#seq&lt;string&gt; * ?references:bool * ?fsiEvaluator:IFsiEvaluator -&gt; LiterateDocument</div>
<div class="tip" id="fs118">val collectHeaders : _arg1:MarkdownParagraph -&gt; (int * MarkdownSpans) list<br /><br />Full name: Library-layers.collectHeaders<br /><em><br /><br />&#160;Helper function that collects headers</em></div>
<div class="tip" id="fs119">union case MarkdownParagraph.Heading: int * MarkdownSpans -&gt; MarkdownParagraph</div>
<div class="tip" id="fs120">val level : int</div>
<div class="tip" id="fs121">val content : MarkdownSpans</div>
<div class="tip" id="fs122">Multiple items<br />module Matching<br /><br />from FSharp.Markdown<br /><br />--------------------<br />module Matching<br /><br />from FSharp.Literate</div>
<div class="tip" id="fs123">Multiple items<br />val ParagraphNested : Matching.ParagraphNestedInfo * pars:MarkdownParagraphs list -&gt; MarkdownParagraph<br /><br />Full name: FSharp.Markdown.Matching.ParagraphNested<br /><br />--------------------<br />active recognizer ParagraphNested: MarkdownParagraph -&gt; Choice&lt;Matching.ParagraphLeafInfo,(Matching.ParagraphNestedInfo * MarkdownParagraphs list),(Matching.ParagraphSpansInfo * MarkdownSpans)&gt;<br /><br />Full name: FSharp.Markdown.Matching.( |ParagraphLeaf|ParagraphNested|ParagraphSpans| )</div>
<div class="tip" id="fs124">val pars : MarkdownParagraphs list</div>
<div class="tip" id="fs125">val concat : lists:seq&lt;&#39;T list&gt; -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.concat</div>
<div class="tip" id="fs126">val collect : mapping:(&#39;T -&gt; &#39;U list) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.collect</div>
<div class="tip" id="fs127">property LiterateDocument.Paragraphs: MarkdownParagraphs</div>
<div class="tip" id="fs128">val generateToc : items:(&#39;a * MarkdownSpans) list -&gt; MarkdownParagraph list (requires comparison)<br /><br />Full name: Library-layers.generateToc<br /><em><br /><br />&#160;Generates Markdown nodes with the TOC</em></div>
<div class="tip" id="fs129">val items : (&#39;a * MarkdownSpans) list (requires comparison)</div>
<div class="tip" id="fs130">val getChildren : (MarkdownParagraph list -&gt; (&#39;b * MarkdownSpans) list -&gt; MarkdownParagraph list) (requires comparison)<br /><em><br /><br />&#160;Split the given list of &#39;items&#39; into the first node,<br />&#160;its children (following items with larger level) and <br />&#160;process the remaining items recursively.</em></div>
<div class="tip" id="fs131">val acc : MarkdownParagraph list</div>
<div class="tip" id="fs132">val items : (&#39;b * MarkdownSpans) list (requires comparison)</div>
<div class="tip" id="fs133">match items with<br />&#160;&#160;&#160;&#160;| [] -&gt; List.rev acc<br />&#160;&#160;&#160;&#160;| [_, leaf] -&gt; [Span leaf]<br />&#160;&#160;&#160;&#160;| ((level, this)::rest) as items -&gt;<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let nested, other = <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;rest |&gt; List.splitAt (fun _ (next, _) -&gt; next &lt;= level)<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let sub = getChildren [] nested<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let par = [ListBlock(Ordered, sub |&gt; List.map (fun s -&gt; [s])); Span this]<br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;getChildren (List.append par acc) other</div>
<div class="tip" id="fs134">val tocPars : MarkdownParagraph list<br /><br />Full name: Library-layers.tocPars</div>
<div class="tip" id="fs135">member LiterateDocument.With : ?paragraphs:MarkdownParagraphs * ?formattedTips:string * ?definedLinks:Collections.Generic.IDictionary&lt;string,(string * string option)&gt; * ?source:LiterateSource * ?sourceFile:string * ?errors:seq&lt;FSharp.CodeFormat.SourceError&gt; -&gt; LiterateDocument</div>
<div class="tip" id="fs136">val append : list1:&#39;T list -&gt; list2:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.append</div>
<div class="tip" id="fs137">static member Literate.WriteHtml : doc:LiterateDocument * ?prefix:string * ?lineNumbers:bool * ?generateAnchors:bool -&gt; string<br />static member Literate.WriteHtml : doc:LiterateDocument * writer:TextWriter * ?prefix:string * ?lineNumbers:bool * ?generateAnchors:bool -&gt; unit</div>


    <div class="info">
    <p class="share">
        <a target="_blank" href="https://twitter.com/intent/tweet?url=http%3a%2f%2ftomasp.net%2fblog%2f2015%2flibrary-layers%2f&amp;text=Library+patterns%3a+Multiple+levels+of+abstractionvia+%40tomaspetricek">
          <i class="fab fa-twitter-square"></i></a>
        <a target="_blank" href="https://www.facebook.com/sharer.php?u=http%3a%2f%2ftomasp.net%2fblog%2f2015%2flibrary-layers%2f">
          <i class="fab fa-facebook-square"></i></a>
        <a href="http://www.reddit.com/submit?url=http%3a%2f%2ftomasp.net%2fblog%2f2015%2flibrary-layers%2f&title=Library+patterns%3a+Multiple+levels+of+abstraction">
          <i class="fab fa-reddit-square"></i></a>
        <a href="mailto:?subject=Library%20patterns%3a%20Multiple%20levels%20of%20abstraction&body=%20Over%20the%20last%20few%20years%2c%20I%20created%20or%20contributed%20to%20a%20number%20of%20libraries.%20In%20this%20blog%20post%20(or%20perhaps%20a%20series)%2c%20I%27ll%20share%20some%20of%20the%20things%20I%20learned%20when%20trying%20to%20answer%20the%20question%3a%20What%20should%20a%20good%20library%20look%20like%3f%20I%27ll%20start%20by%20looking%20at%20a%20library%20design%20pattern%20that%20I%20call%20%27levels%20of%20abstraction%27.%0a%0aSee%3a%20http%3a%2f%2ftomasp.net%2fblog%2f2015%2flibrary-layers%2f">
          <i class="fa fa-envelope"></i></a>
    </p>
    <p class="details">
      <strong>Published:</strong> Tuesday, 3 February 2015, 4:54 PM<br />
      <strong>Author:</strong> Tomas Petricek<br />
      <strong>Typos:</strong> <a href="http://github.com/tpetricek/tomasp.net">Send me a pull request</a>!<br />
      
        <strong>Tags:</strong> <a
          href="/blog/tag/fsharp/">f#</a>, <a
          href="/blog/tag/open-source/">open source</a>, <a
          href="/blog/tag/functional-programming/">functional programming</a></span><br />
      
    </p>
    </div>
  </article>


  <footer>
  <div class="footer-body">
    <div class="fl70"><div class="fmr">
      <h4><a href="http://tomasp.net/rss.xml"><i class="fa fa-rss" style="margin-right:5px;"></i></a> Blog archives</h4>
      <p>
      
      <a href="/blog/archive/february_2025/">February 2025 (1)</a>,&nbsp;
      
      <a href="/blog/archive/december_2023/">December 2023 (1)</a>,&nbsp;
      
      <a href="/blog/archive/february_2023/">February 2023 (1)</a>,&nbsp;
      
      <a href="/blog/archive/september_2022/">September 2022 (1)</a>,&nbsp;
      
      <a href="/blog/archive/april_2022/">April 2022 (1)</a>,&nbsp;
      
      <a href="/blog/archive/october_2021/">October 2021 (1)</a>,&nbsp;
      
      <a href="/blog/archive/april_2021/">April 2021 (1)</a>,&nbsp;
      
      <a href="/blog/archive/october_2020/">October 2020 (1)</a>,&nbsp;
      
      <a href="/blog/archive/july_2020/">July 2020 (1)</a>,&nbsp;
      
      <a href="/blog/archive/april_2020/">April 2020 (2)</a>,&nbsp;
      
      <a href="/blog/archive/december_2019/">December 2019 (1)</a>,&nbsp;
      
      <a href="/blog/archive/february_2019/">February 2019 (1)</a>,&nbsp;
      
      <a href="/blog/archive/november_2018/">November 2018 (1)</a>,&nbsp;
      
      <a href="/blog/archive/october_2018/">October 2018 (1)</a>,&nbsp;
      
      <a href="/blog/archive/may_2018/">May 2018 (1)</a>,&nbsp;
      
      <a href="/blog/archive/september_2017/">September 2017 (1)</a>,&nbsp;
      
      <a href="/blog/archive/june_2017/">June 2017 (1)</a>,&nbsp;
      
      <a href="/blog/archive/april_2017/">April 2017 (1)</a>,&nbsp;
      
      <a href="/blog/archive/march_2017/">March 2017 (2)</a>,&nbsp;
      
      <a href="/blog/archive/january_2017/">January 2017 (1)</a>,&nbsp;
      
      <a href="/blog/archive/october_2016/">October 2016 (1)</a>,&nbsp;
      
      <a href="/blog/archive/september_2016/">September 2016 (2)</a>,&nbsp;
      
      <a href="/blog/archive/august_2016/">August 2016 (1)</a>,&nbsp;
      
      <a href="/blog/archive/july_2016/">July 2016 (1)</a>,&nbsp;
      
      <a href="/blog/archive/may_2016/">May 2016 (2)</a>,&nbsp;
      
      <a href="/blog/archive/april_2016/">April 2016 (1)</a>,&nbsp;
      
      <a href="/blog/archive/december_2015/">December 2015 (2)</a>,&nbsp;
      
      <a href="/blog/archive/november_2015/">November 2015 (1)</a>,&nbsp;
      
      <a href="/blog/archive/september_2015/">September 2015 (3)</a>,&nbsp;
      
      <a href="/blog/archive/july_2015/">July 2015 (1)</a>,&nbsp;
      
      <a href="/blog/archive/june_2015/">June 2015 (1)</a>,&nbsp;
      
      <a href="/blog/archive/may_2015/">May 2015 (2)</a>,&nbsp;
      
      <a href="/blog/archive/april_2015/">April 2015 (3)</a>,&nbsp;
      
      <a href="/blog/archive/march_2015/">March 2015 (2)</a>,&nbsp;
      
      <a href="/blog/archive/february_2015/">February 2015 (1)</a>,&nbsp;
      
      <a href="/blog/archive/january_2015/">January 2015 (2)</a>,&nbsp;
      
      <a href="/blog/archive/december_2014/">December 2014 (1)</a>,&nbsp;
      
      <a href="/blog/archive/may_2014/">May 2014 (3)</a>,&nbsp;
      
      <a href="/blog/archive/april_2014/">April 2014 (2)</a>,&nbsp;
      
      <a href="/blog/archive/march_2014/">March 2014 (1)</a>,&nbsp;
      
      <a href="/blog/archive/january_2014/">January 2014 (2)</a>,&nbsp;
      
      <a href="/blog/archive/december_2013/">December 2013 (1)</a>,&nbsp;
      
      <a href="/blog/archive/november_2013/">November 2013 (1)</a>,&nbsp;
      
      <a href="/blog/archive/october_2013/">October 2013 (1)</a>,&nbsp;
      
      <a href="/blog/archive/september_2013/">September 2013 (1)</a>,&nbsp;
      
      <a href="/blog/archive/august_2013/">August 2013 (2)</a>,&nbsp;
      
      <a href="/blog/archive/may_2013/">May 2013 (1)</a>,&nbsp;
      
      <a href="/blog/archive/april_2013/">April 2013 (1)</a>,&nbsp;
      
      <a href="/blog/archive/march_2013/">March 2013 (1)</a>,&nbsp;
      
      <a href="/blog/archive/february_2013/">February 2013 (1)</a>,&nbsp;
      
      <a href="/blog/archive/january_2013/">January 2013 (1)</a>,&nbsp;
      
      <a href="/blog/archive/december_2012/">December 2012 (2)</a>,&nbsp;
      
      <a href="/blog/archive/october_2012/">October 2012 (1)</a>,&nbsp;
      
      <a href="/blog/archive/august_2012/">August 2012 (3)</a>,&nbsp;
      
      <a href="/blog/archive/june_2012/">June 2012 (2)</a>,&nbsp;
      
      <a href="/blog/archive/april_2012/">April 2012 (1)</a>,&nbsp;
      
      <a href="/blog/archive/march_2012/">March 2012 (4)</a>,&nbsp;
      
      <a href="/blog/archive/february_2012/">February 2012 (5)</a>,&nbsp;
      
      <a href="/blog/archive/january_2012/">January 2012 (2)</a>,&nbsp;
      
      <a href="/blog/archive/november_2011/">November 2011 (5)</a>,&nbsp;
      
      <a href="/blog/archive/august_2011/">August 2011 (3)</a>,&nbsp;
      
      <a href="/blog/archive/july_2011/">July 2011 (2)</a>,&nbsp;
      
      <a href="/blog/archive/june_2011/">June 2011 (2)</a>,&nbsp;
      
      <a href="/blog/archive/may_2011/">May 2011 (2)</a>,&nbsp;
      
      <a href="/blog/archive/march_2011/">March 2011 (4)</a>,&nbsp;
      
      <a href="/blog/archive/december_2010/">December 2010 (1)</a>,&nbsp;
      
      <a href="/blog/archive/november_2010/">November 2010 (6)</a>,&nbsp;
      
      <a href="/blog/archive/october_2010/">October 2010 (6)</a>,&nbsp;
      
      <a href="/blog/archive/september_2010/">September 2010 (4)</a>,&nbsp;
      
      <a href="/blog/archive/july_2010/">July 2010 (3)</a>,&nbsp;
      
      <a href="/blog/archive/june_2010/">June 2010 (2)</a>,&nbsp;
      
      <a href="/blog/archive/may_2010/">May 2010 (1)</a>,&nbsp;
      
      <a href="/blog/archive/february_2010/">February 2010 (2)</a>,&nbsp;
      
      <a href="/blog/archive/january_2010/">January 2010 (3)</a>,&nbsp;
      
      <a href="/blog/archive/december_2009/">December 2009 (3)</a>,&nbsp;
      
      <a href="/blog/archive/july_2009/">July 2009 (1)</a>,&nbsp;
      
      <a href="/blog/archive/june_2009/">June 2009 (3)</a>,&nbsp;
      
      <a href="/blog/archive/may_2009/">May 2009 (2)</a>,&nbsp;
      
      <a href="/blog/archive/april_2009/">April 2009 (1)</a>,&nbsp;
      
      <a href="/blog/archive/march_2009/">March 2009 (2)</a>,&nbsp;
      
      <a href="/blog/archive/february_2009/">February 2009 (1)</a>,&nbsp;
      
      <a href="/blog/archive/december_2008/">December 2008 (1)</a>,&nbsp;
      
      <a href="/blog/archive/november_2008/">November 2008 (5)</a>,&nbsp;
      
      <a href="/blog/archive/october_2008/">October 2008 (1)</a>,&nbsp;
      
      <a href="/blog/archive/september_2008/">September 2008 (1)</a>,&nbsp;
      
      <a href="/blog/archive/june_2008/">June 2008 (1)</a>,&nbsp;
      
      <a href="/blog/archive/march_2008/">March 2008 (3)</a>,&nbsp;
      
      <a href="/blog/archive/february_2008/">February 2008 (1)</a>,&nbsp;
      
      <a href="/blog/archive/december_2007/">December 2007 (2)</a>,&nbsp;
      
      <a href="/blog/archive/november_2007/">November 2007 (6)</a>,&nbsp;
      
      <a href="/blog/archive/october_2007/">October 2007 (1)</a>,&nbsp;
      
      <a href="/blog/archive/september_2007/">September 2007 (1)</a>,&nbsp;
      
      <a href="/blog/archive/august_2007/">August 2007 (1)</a>,&nbsp;
      
      <a href="/blog/archive/july_2007/">July 2007 (2)</a>,&nbsp;
      
      <a href="/blog/archive/april_2007/">April 2007 (2)</a>,&nbsp;
      
      <a href="/blog/archive/march_2007/">March 2007 (2)</a>,&nbsp;
      
      <a href="/blog/archive/february_2007/">February 2007 (3)</a>,&nbsp;
      
      <a href="/blog/archive/january_2007/">January 2007 (2)</a>,&nbsp;
      
      <a href="/blog/archive/november_2006/">November 2006 (1)</a>,&nbsp;
      
      <a href="/blog/archive/october_2006/">October 2006 (3)</a>,&nbsp;
      
      <a href="/blog/archive/august_2006/">August 2006 (2)</a>,&nbsp;
      
      <a href="/blog/archive/july_2006/">July 2006 (1)</a>,&nbsp;
      
      <a href="/blog/archive/june_2006/">June 2006 (3)</a>,&nbsp;
      
      <a href="/blog/archive/may_2006/">May 2006 (2)</a>,&nbsp;
      
      <a href="/blog/archive/april_2006/">April 2006 (2)</a>,&nbsp;
      
      <a href="/blog/archive/december_2005/">December 2005 (1)</a>,&nbsp;
      
      <a href="/blog/archive/july_2005/">July 2005 (4)</a>,&nbsp;
      
      <a href="/blog/archive/june_2005/">June 2005 (5)</a>,&nbsp;
      
      <a href="/blog/archive/may_2005/">May 2005 (1)</a>,&nbsp;
      
      <a href="/blog/archive/april_2005/">April 2005 (3)</a>,&nbsp;
      
      <a href="/blog/archive/march_2005/">March 2005 (3)</a>,&nbsp;
      
      <a href="/blog/archive/january_2005/">January 2005 (1)</a>,&nbsp;
      
      <a href="/blog/archive/december_2004/">December 2004 (3)</a>,&nbsp;
      
      <a href="/blog/archive/november_2004/">November 2004 (2)</a>,&nbsp;
      
      </p>
    </div></div>
    <div class="fr30"><div class="fmr">
      <h4>License and about</h4>
      <p>All articles on this site are licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution Share Alike</a>.
        All source code samples are licensed under the MIT License.
      </p>
      <p>This site is hosted on GitHub and is generated using <a href="https://github.com/tpetricek/FSharp.Formatting">F# Formatting</a>
        and <a href="http://dotliquidmarkup.org/">DotLiquid</a>.
        For more info, see the <a href="https://github.com/tpetricek/tomasp.net">website source on GitHub</a>.
      </p>
      <p>Please submit issues &amp; corrections on GitHub. Use pull requests for minor corrections only.</p>
      <ul>
        <li><i class="fab fa-twitter"></i> Twitter: <a href="http://twitter.com/tomaspetricek">@tomaspetricek</a></li>
        <li><i class="fab fa-github"></i> GitHub: <a href="https://github.com/tpetricek">@tpetricek</a></li>
        <li><i class="fa fa-envelope"></i> Email: <a href="mailto:tomas@tomasp.net">tomas@tomasp.net</a></li>
      </ul>
      <p style="text-align:center;margin-top:15px;"><img src="https://tomasp.net/img/cc-sa.png" alt="CC License logo" /></p>
    </div></div>
  </div>
  </footer>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1561220-1']);
    _gaq.push(['_trackPageview']);
    (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</body>
</html>
